# R суурь ойлголтууд

```{r out.width = "100%", fig.align = "center", echo=F}
knitr::include_graphics(here::here("images", "basics_header_close.png"))
```

Тавтай морилно уу!

Энэхүү бүлэгт бид R-ын талаарх үндсэн ойлголтуудыг авч үзнэ. Энэ нь дэлгэрэнгүй заавар болох зорилгогүй бөгөөд танд R-ын талаар анхан шатны мэдлэгийг өгч, мөн өмнө ашиглаж байсан хүмүүст ой санамжаа сэргээхэд тустай байх болно. [Сургалтын материалууд](#learning) хэсэгт илүү дэлгэрэнгүй сургалтын линкүүд буй.

Энэ хуудасны зарим хэсгийг [R4Epis төслийн](https://r4epis.netlify.app/) зөвшөөрлөөр бага зэрэг өөрчлөн авч ашигласан.

STATA, SAS, эсвэл Excel-ээс R руу шилжих зөвлөмжийг \[R руу шилжих\] хуудаснаас үзнэ үү.

```{r, echo=F}
# цэвэрлэсэн Эбола лайнлистийг импортлох
linelist <- rio::import(here::here("data", "case_linelists", "linelist_cleaned.rds"))
pacman::p_load(apyramid)
```

<!-- ======================================================= -->

## Яагаад R-г ашиглана гэж?

[R төслийн вэбсайтад](https://www.r-project.org/about.html) дурдсанчлан R бол статистикийн тооцоолол, график хийхэд зориулсан програмчлалын хэл, түүний орчин юм. R нь маш уян хатан, өргөтгөх боломжтой, хөгжил нь хэрэглэгчдээрээ удирдуулдаг программ юм.

**Зардал**

R ашиглахад үнэгүй! Чөлөөт, нээлттэй эх сурвалжийн эргэн тойрон өндөр ёс зүйтэй байдаг.

**Давтагдах чадвар**

Дата менежмент, дата анализийг програмчлалын хэлээр (Excel эсвэл бусад голчлон товчлуур дээр дардаг/гараар хийдэг хэрэгслүүдтэй харьцуулахад) хийх нь **давтагдах чадварыг** сайжруулж, **алдааг илрүүлэхэд** амар болж, таны ажлын ачааллыг хөнгөвчилдөг.

**Хамт олон**

R хэрэглэгчдийн хамт олон маш том бөгөөд нэгэндээ үргэлж туслан хамтран ажилладаг. Амьдрал дээр тулгарч буй олон асуудлыг шийдвэрлэх шинэ багц, хэрэгслүүд өдөр бүр гарч, тэдгээрийг нь R хэрэглэгчид хэрэглэж үзэн байнга шалгаж байдаг. Үүний нэг жишээ болох [R-Ladies](https://rladies.org/) нь дэлхий даяар салбартай, R хэрэглэгчдийн хамгийн том байгууллагуудын нэг бөгөөд гол зорилго нь R хэрэглэгчдийн дундах жендэрийн олон талт байдлыг хангах, дэмжих явдал юм. Таны ойролцоо ч салбар нь байдаг байж магадгүй!

## Гол нэр томъёо

**RStudio** - RStudio бол **R**-ийг ашиглахад хялбар болгож буй хэрэглэгчийн график интерфэйс (GUI) юм. Дэлгэрэнгүйг [RStudio хэсгээс](#rstudio) уншина уу.

**Объектууд** - Таны R-д хадгалдаг бүх зүйл - датасетүүд, хувьсагч, тосгоны нэрсийн жагсаалт, хүн амын нийт тоо, тэр ч байтугай график гэх мэт гаралтууд - нь нэр оноогдсон объект бөгөөд тэрхүү нэрийг ашиглан дараагийн командуудад дуудаж болдог. Дэлгэрэнгүйг [Объектууд хэсгээс](#objects) уншина уу.

**Функцууд** - Функц нь оролтыг хүлээн авч, хувиргасан гаралтыг буцааж өгдөг кодын үйлдэл юм. Дэлгэрэнгүйг [Функц хэсгээс](#functions) уншина уу.

**Багцууд** - R багц гэдэг нь функцүүдийн нэгдэл юм. Дэлгэрэнгүй мэдээллийг [Багц хэсгээс](#packages) уншина уу.

**Скриптүүд** - Скрипт бол таны командуудыг агуулсан файл юм. Дэлгэрэнгүйг [Скриптүүд хэсгээс](#scripts) уншина уу

## Сургалтын материалууд {#learning}

### RStudio доторх материалууд {.unnumbered}

**Тусламжийн баримт бичиг**

R багц болон функцуудын талаархи баримт бичгийг RStudio-гийн "Help" таб дээрээс хайж болно. Энэ нь Files, Plots болон Packages бүхий хэсэгт байдаг (ихэвчлэн баруун доод хэсэгт). Хурдан хандая гэвэл та R консол дотор асуултын тэмдгийн дараа тухайн багц эсвэл функцын нэрийг бичсэнээр хамааралтай Help хуудсыг нээж болно. Ингэхдээ хаалтгүйгээр бичнэ үү.

Жишээлбэл: `?filter` эсвэл `?diagrammeR`.

**Интерактив хичээлүүд**

RStudio дотор R-ийг интерактив байдлаар сурах хэд хэдэн арга байдаг.

RStudio өөрөө [learnr](https://blog.rstudio.com/2020/02/25/rstudio-1-3-integrated-tutorials/) хэмээх R багцаар ажилладаг Tutorial хэсгийг санал болгодог. Ердөө л энэ багцыг суулгаад RStudio-ийн баруун дээд хэсэгт байрлах "Tutorial" табыг ашиглан хичээлээ нээнэ үү (Environment болон History табуудыг агуулсан хэсэг).

R багц [**swirl**](https://swirlstats.com/)нь R консол дотор ажиллаж болох интерактив курсуудыг санал болгодог. Энэ багцыг суулгаад ачаалсны дараа R консол дээр `swirl()` (хоосон хаалттай) командыг ажиллуулна уу. Таны консол дээр асуулт гарч ирэх болно. Консол дээрээ бичээд хариулна уу. Ийм байдлаар таны сонгосон хичээлийг удирдан явуулах болно.

### Cheatsheets {.unnumbered}

[RStudio вэбсайт](https://rstudio.com/resources/cheatsheets/) дээр олон PDF "cheatsheets" байдаг, жишээлбэл:

-   Факторын **forcats** багц

-   Огноо, цагийн **lubridate** багц

-   Стрингүүдийн **stringr** багц

-   Давтагдах үйлдлүүдэд зориулсан **purrr** багц

-   Дата импортлох

-   **dplyr** багцын дата хувиргах cheatsheet

-   R Markdown (PDF, Word, Powerpoint гэх мэт баримт бичиг үүсгэхийн тулд)

-   Shiny (интерактив вэб апп бүтээх)

-   Дата зураглалын **ggplot2** багц

-   Картографи (GIS)

-   **leaflet** багц (интерактив газрын зураг)

-   Python-ийг R-тай хамт ашиглах (**reticulate** багц)

Энэ бол [Excel хэрэглэгчдэд](https://jules32.github.io/r-for-excel-users/) зориулагдсан онлайн материал.

### Twitter {.unnumbered}

R нь маш идэвхтэй жиргээчдийн хамт олонтой бөгөөд эндээс та R-тай холбоотой төрөл бүрийн зөвлөгөө, товчлол, мэдээ авч болно. Эдгээр хаягуудыг дагана уу:

-   Биднийг дагаарай! [\@epiRhandbook](https://twitter.com/epirhandbook)\
-   Өдөрт нэг R функц [\@rfuntionaday](https://twitter.com/rfunctionaday) хэмээх энэ хаяг бол *маш сайн* мэдээлэлтэй\
-   Дата шинжлэх ухаанд R-ыг [\@rstats4ds](https://twitter.com/rstats4ds?lang=en)\
-   RStudio [\@RStudio](https://twitter.com/rstudio?lang=en)\
-   RStudio зөвлөгөөнүүд [\@rstudiotips](https://twitter.com/rstudiotips)\
-   R-Bloggers [\@Rbloggers](https://twitter.com/Rbloggers)\
-   R-ladies [\@RLadiesGlobal](https://twitter.com/RLadiesGlobal)\
-   Hadley Wickham [\@hadleywickham](https://twitter.com/hadleywickham?ref_src=twsrc%5Egoogle%7Ctwcamp%5Eserp%7Ctwgr%5Eauthor)

Мөн:

**#epitwitter** болон **#rstats**

### Үнэгүй онлайн материалууд {.unnumbered}

Hadley Wickham, Garrett Grolemund нарын бичсэн [Дата шинжлэх ухаанд R](https://r4ds.had.co.nz/)-ыг ном нь энэ чиглэлийн хамгийн гол сурах бичиг юм.

[R4Epis төслийн](https://r4epis.netlify.app/) вэбсайт нь "[MSF](https://www.msf.org/)-ийн яаралтай тусламжийн нөхцөлд тохиолддог дэгдэлтийн түгээмэл төрлүүд болон хүн амд суурилсан асуумж судалгааны дата цэвэрлэх, анализ хийх, тайлан гаргахад зориулсан стандартчилагдсан хэрэгслүүдийг боловсруулах" зорилготой юм. Та эндээс R-ын анхан шатны сургалтын материалууд, дэгдэлт, асуумж судалгааны RMarkdown тайлангийн загвар болон тэдгээрийг ашиглаж эхлэхэд туслах хичээлүүдийг олж болно.

### Англи хэлээс бусад хэл {.unnumbered}

[Materiales de RStudio en Español](https://www.rstudio.com/collections/espanol/)

[Introduction à R et au tidyverse (Francais)](https://juba.github.io/tidyverse/index.html)

<!-- ======================================================= -->

## Суулгалт

### R болон RStudio {.unnumbered}

**R хэрхэн суулгах вэ**

<https://www.r-project.org/> вэбсайт руу орж өөрийн компьютерт тохирсон R-ын хамгийн сүүлийн хувилбарыг татаж авна уу.

**RStudio хэрхэн суулгах вэ**

<https://rstudio.com/products/rstudio/download/> вэбсайт руу орж өөрийн компьютерт тохирсон RStudio-гийн хамгийн сүүлийн үеийн үнэгүй хувилбарыг татаж авна уу.

**Зөвшөөрлүүд**\
Та R ба RStudio-г өөрийн унших (read), бичих (write) зөвшөөрөлтэй драйвт суулгах ёстойг анхаарна уу. Тэгэхгүй бол таны R багцуудыг суулгах явцад (түгээмэл тохиолддог) сөргөөр нөлөөлөх болно. Хэрэв танд асуудал тулгарвал RStudio нээх лого дээр хулганы баруун товчийг дараад "Run as administrator" сонгон нээхийг оролдоно уу. Бусад зөвлөмжийг \[Сүлжээний драйв дээрх R\] хуудаснаас олж болно.

**R болон RStudio-г хэрхэн шинэчлэх вэ**

R-ийг эхлүүлэх үед консол дээр таны R программын хувилбар харагддаг. Мөн та `sessionInfo()` функцийг ажиллуулан харж болно.

R-г шинэчлэхийн тулд дээр дурдсан вэбсайт руу орж R-г дахин суулгаарай. Өөрөөр **installr** багцын (Windows дээр) `installr::updateR()` функцыг ажиллуулснаар шинэчилж болно. Энэ функц нь танд хамгийн сүүлийн үеийн R хувилбарыг татаж авах, багцуудаа шинэ R хувилбар болгон шинэчлэхэд туслах харилцах цонхыг нээх болно. Дэлгэрэнгүй мэдээллийг **installr** [баримт бичгээс](https://www.r-project.org/nosvn/pandoc/installr.html) олж болно.

Ингэж суулгасны дараа R-ын хуучин хувилбар таны компьютер дээр байсаар байх болно гэдгийг анхаарна уу. Та RStudio дээрх "Tools" -> "Global Options" дээр дарж R хувилбарыг сонгож R-ын хуучин хувилбарыг (хуучин "суулгац") түр ажиллуулж болно. Энэ үйлдэл нь та R-ын хамгийн сүүлийн хувилбарт зориулан шинэчлэгдээгүй байгаа багцыг ашиглах шаардлагатай үед хэрэг болдог.

RStudio-г шинэчлэхийн тулд та дээрх вэбсайт руу орж RStudio-г дахин татаж авах боломжтой. Өөр нэг сонголт нь RStudio дотор "Help" -> "Check for Updates" дээр дарах бөгөөд гэвч энэ нь хамгийн сүүлийн үеийн шинэчлэлтийг харуулахгүй байж магадгүй.

Энэхүү гарын авлагыг бүтээхэд R, RStudio эсвэл багцуудын аль хувилбарыг ашигласан болохыг харахын тулд \[Редакцийн болон техникийн тэмдэглэл\] хуудсыг үзнэ үү.

### Суулгах шаардлагатай болж магадгүй бусад програм хангамж {.unnumbered}

-   TinyTeX (*RMarkdown-ыг PDF болгон нэгтгэхэд зориулсан*)\
-   Pandoc (*RMarkdown-ыг нэгтгэхэд зориулсан*)\
-   RTools (*R-ын багцуудыг угсрахад зориулсан*)\
-   phantomjs (*халдварын гинжин хэлхээ гэх мэт хөдөлгөөнт сүлжээнүүдийн хөдөлгөөнгүй зургийг хадгалахад зориулсан*)

#### TinyTex {.unnumbered}

TinyTex бол LaTeX-ийн custom түгээлт бөгөөд R-аас PDF үүсгэхэд хэрэгтэй байдаг. Дэлгэрэнгүй мэдээллийг <https://yihui.org/tinytex/> харна уу.

R-аас TinyTex-ийг суулгахын тулд:

```{r, eval=F}
install.packages('tinytex')
tinytex::install_tinytex()
# TinyTeX-ийг устгахын тулд tinytex::uninstall_tinytex() ажиллуулна
```

#### Pandoc {.unnumbered}

Pandoc бол баримт бичиг хөрвүүлэгч, R-аас тусдаа програм хангамж юм. **Энэ нь RStudio-той цуг ирдэг тул тусад нь татаж авах шаардлагагүй.** Pandoc нь Rmarkdown-ыг .pdf гэх мэт формат руу хөрвүүлэх, комплекс үйлдлүүд хийхэд тусалдаг.

#### RTools {.unnumbered}

RTools бол R-д зориулсан багц үүсгэх програм хангамжийн цуглуулга юм.

Энэ вэбсайтаас суулгана: <https://cran.r-project.org/bin/windows/Rtools/>

#### phantomjs {.unnumbered}

Энэ нь ихэвчлэн вэб хуудсуудын "screenshot" авахад ашиглагддаг. Жишээлбэл, та **epicontacts** багц ашиглан халдварын гинжин хэлхээ хийх үед интерактив, динамик HTML файлыг гаргадаг. Хэрэв та үүнээс статик зураг авахыг хүсч байвал энэ үйл явцыг автоматжуулахын тулд [**webshot**](https://wch.github.io/webshot/articles/intro.html)багцыг ашиглаж болно. Үүний тулд "phantomjs" програм шаардлагатай. Та **webshot** багцаар дамжуулан `webshot::install_phantomjs()` командын тусламжтайгаар phantomjs-ийг суулгаж болно.

<!-- ======================================================= -->

## RStudio {#rstudio}

### RStudio чиг баримжаа {.unnumbered}

**Эхлээд RStudio-г нээ.** Тэдний лого нь хоорондоо маш төстэй харагддаг тул та R биш *RStudio*-г нээж байгаа эсэхээ шалгаарай.

RStudio-ийг ажиллуулахын тулд та компьютер дээрээ R суулгасан байх ёстой (суулгах зааврыг дээрээс үзнэ үү).

**RStudio** нь R ашиглахыг хялбарчилж буй интерфэйс юм (GUI). Та R-ыг машины хөдөлгүүр, гол ажлыг нь хийж байгаа гэж, харин RStudio-г тухайн хөдөлгүүрийг урагшлуулахад тусалдаг машины их бие (суудал, дагалдах хэрэгсэл гэх мэт) гэж ойлгож болно! Та RStudio хэрэглэгчийн интерфэйсийн бүрэн cheatsheet-ийг (PDF) [эндээс](https://www.rstudio.com/wp-content/uploads/2016/01/rstudio-IDE-cheatsheet.pdf) үзэх боломжтой.

Хамгийн эхний байдлаар RStudio нь дөрвөн тэгш өнцөгт самбарыг харуулдаг.

```{r out.width = "100%", fig.align = "center", echo=F}
knitr::include_graphics(here::here("images", "RStudio_overview.png"))
```

[***ЗӨВЛӨГӨӨ:*** Хэрэв таны RStudio зүүн талдаа ганцхан дэлгэцтэй байгаа бол энэ нь та скриптүүд хараахан нээгээгүй байгаатай холбоотой юм.]{style="color: black;"}

**Үүсвэр самбар (Source pane)**\
Эхний байдлаар зүүн дээд буланд байдаг энэ самбар нь [скриптүүдээ](#scripts) засварлах, ажиллуулах, хадгалах зай юм. Скриптүүд нь таны ажиллуулахыг хүссэн командуудыг агуулдаг. Энэ самбар нь мөн датасетүүд (датафрэйм) харуулах боломжтой.

Stata хэрэглэгчдийн хувьд энэ самбар нь таны Do-file болон Data Editor цонхтой төстэй юм.

**R консол самбар (Console pane)**

RStudio дотор R консол нь зүүн эсвэл зүүн доод хэсэгт эхний байдлаар байрладаг бөгөөд R-ын "хөдөлгүүр"-ийн гэр юм. Энэ нь командуудын ажилладаг хэсэг бөгөөд график бус гаралт, алдаа/анхааруулах мессеж гарч ирдэг. Та R консолд командуудыг шууд оруулж ажиллуулж болох боловч скриптээс командыг ажиллуулахад хадгалагдаж үлддэг шиг эдгээр командууд хадгалагддаггүй гэдгийг ойлгоорой.

Хэрэв та Stata мэддэг бол R консол нь Command Window болон Results Window-тэй адил юм.

**Орчны самбар (Environment Pane)**\
Програм нээгдэх үед баруун дээд буланд байдаг энэ самбарыг ихэвчлэн тухайн ажиллаж буй үеийн R-ын орчинд буй [объектуудын](#objects#objects#objects#objects#objects#objects#objects) товч мэдээллийг харахад ашигладаг. Эдгээр объектууд нь импортолсон, өөрчлөгдсөн эсвэл үүсгэсэн датасетүүд, таны тодорхойлсон параметрүүд (жишээлбэл, тухайн анализад зориулсан тодорхой эпи долоо хоног), эсвэл анализ хийх үед тодорхойлсон векторууд эсвэл листүүд (жишээлбэл, бүс нутгийн нэрс) байж болно. Та датафрэймийн нэрний хажууд байгаа сумыг дарж хувьсагчдыг нь харах боломжтой.

STATA-д энэ нь Variables Manager цонхтой хамгийн төстэй юм.

Энэ самбарт мөн өмнө нь ажиллуулсан командуудыг харах боломжтой *History* таб орно. Мөн та **learnr** багцыг суулгасан бол интерактив R хичээл хийх боломжтой "Tutorial" таб энд байдаг. Эдгээрээс гадна энэхүү самбарт гадаад холболт хийхэд зориулсан "Connections" таб, Github-тай интерфэйс хийвэл гарч ирдэг "Git" хэмээх табуудыг агуулагддаг.

**Plots, Viewer, Packages, болон Help самбар**

Баруун доод хэсэгт хэд хэдэн чухал табууд байдаг. Газрын зураг зэргийг багтаасан түгээмэл график дүрслэлүүдийг Plot таб дээр харуулна. Интерактив эсвэл HTML гаралтууд нь Viewer табд гарч ирнэ. Help таб нь баримт бичиг, тусламжийн файлуудыг харуулдаг. Файлын самбар нь файл нээх эсвэл устгахад зориулагдсан хөтөч юм. Packages таб нь танд R багцыг харах, суулгах, шинэчлэх, устгах, ачаалах/буулгах, танд байгаа багцын хувилбарыг харах боломжийг олгодог. Багцын талаар илүү ихийг мэдэхийг хүсвэл доорх [багц хэсгээс](#packages) үзнэ үү.

Энэ самбар нь Stata-гийн Plots Manager болон Project Manager цонхнуудтай төстэй мэдээлэл агуулдаг.

### RStudio тохируулгууд {.unnumbered}

RStudio-ийн тохиргоо болон харагдах байдлыг Tools цэснээс Global Options-ийг сонгон өөрчилнө үү. Тэнд та харагдах байдал/дэвсгэр өнгө зэрэг үндсэн тохиргоонуудыг өөрчилж болно.

```{r out.width = c('50%'), fig.show='hold', echo=F}
knitr::include_graphics(here::here("images", "RStudio_tools_options_1.png"))

knitr::include_graphics(here::here("images", "RStudio_tools_options.png"))
```

**Дахин эхлүүлэх (Restart)**

Хэрэв таны R гацвал Session цэс рүү ороод "Restart R" дээр дарж R-г дахин эхлүүлж болно. Энэ нь RStudio-г бүхэлд нь хааж, нээхээс зайлсхийдэг. Үүнийг хийснээр таны R орчинд байгаа бүх зүйл устах болно.

### Гарын товчлолууд (Keyboard shortcuts) {.unnumbered}

Зарим тун хэрэгтэй гарын товчлолуудыг доор харуулав. Энэхүү RStudio [хэрэглэгчийн интерфэйсийн cheatsheet](https://github.com/rstudio/cheatsheets/raw/master/rstudio-ide.pdf)-ийн хоёр дахь хуудаснаас Windows, Mac, Linux-ийн бүх гарын товчлолыг үзнэ үү.

| Windows/Linux                          | Mac                    | Үйлдэл                                                                                                                                         |
|----------------------------------------|------------------------|------------------------------------------------------------------------------------------------------------------------------------------------|
| Esc                                    | Esc                    | Одоогийн командыг зогсоох (хэрэв та санамсаргүйгээр бүрэн бус командыг ажиллуулаад R консол дээр "+" тэмдэг гарчихаад байгаа үед хэрэг болдог) |
| Ctrl+s                                 | Cmd+s                  | Хадгалах (скрипт)                                                                                                                              |
| Tab                                    | Tab                    | Автоматаар дүүргэх                                                                                                                             |
| Ctrl + Enter                           | Cmd + Enter            | Одоогийн кодын мөр(үүд)/сонголтыг ажиллуулах                                                                                                   |
| Ctrl + Shift + C                       | Cmd + Shift + c        | Тодруулсан мөрүүдэд тайлбар нэмэх/тайлбарыг арилгах                                                                                            |
| Alt + -                                | Option + -             | `<-` тэмдэг оруулах                                                                                                                            |
| Ctrl + Shift + m                       | Cmd + Shift + m        | `%>%` тэмдэг оруулах                                                                                                                           |
| Ctrl + l                               | Cmd + l                | R консол цэвэрлэх                                                                                                                              |
| Ctrl + Alt + b                         | Cmd + Option + b       | Эхнээс одоогийн мөр хүртэл ажиллуулах                                                                                                          |
| Ctrl + Alt + t                         | Cmd + Option + t       | Одоогийн кодын хэсгийг ажиллуулах (R Markdown)                                                                                                 |
| Ctrl + Alt + i                         | Cmd + Shift + r        | Кодын хэсэг оруулах (R Markdown руу)                                                                                                           |
| Ctrl + Alt + c                         | Cmd + Option + c       | Кодын хэсэг ажиллуулах (R Markdown)                                                                                                            |
| R консолд дээшээ/доошоо сумаар         | Ижил                   | Саяхан ажиллуулсан командуудыг сэлгэх                                                                                                          |
| Скрипт дотор Shift + дээшээ/доошоо сум | Ижил                   | Олон кодын мөрийг сонгох                                                                                                                       |
| Ctrl + f                               | Cmd + f                | Одоогийн скрипт дотор хайж олоод солих                                                                                                         |
| Ctrl + Shift + f                       | Cmd + Shift + f        | Файлуудаас хайх (олон скриптийн дунд хайх/солих)                                                                                               |
| Alt + l                                | Cmd + Option + l       | Сонгосон кодыг хумих                                                                                                                           |
| Shift + Alt + l                        | Cmd + Shift + Option+l | Сонгосон кодыг дэлгэх                                                                                                                          |

[***ЗӨВЛӨГӨӨ:*** RStudio-ийн автоматаар дүүргэх үйлдлийг ашиглахын тулд бичихдээ Tab товчлуураа ашиглана уу. Ингэснээр функцын нэрийг буруу бичихээс урьдчилан сэргийлэх боломжтой юм. Бичлэгийн дундаа Tab товчийг дарснаар одоог хүртэл бичсэн байгаа зүйл дээр үндэслэн байж болох боломжит функцууд болон объектуудын жагсаалтыг гаргана.]{style="color: darkgreen;"}

<!-- ======================================================= -->

## Функцууд {#functions}

Функцууд нь R-ыг ашиглах гол цөм болдог. Функцын тусламжтайгаар та төрөл бүрийн даалгавар, үйлдлүүдийг гүйцэтгэх боломжтой болж буй юм. Нэлээд олон функцууд R-тай хамт суулгагдан ирдэг бөгөөд бусад олон функцуудыг *багц* хэлбэрээр татаж авах боломжтойгоос ([багцууд](#packages) хэсэгт тайлбарласан) гадна та өөрийн хүссэн функцээ өөрөө бичиж болно!

Энэхүү функцийн талаархи суурь ойлголтын хэсэгт дараах зүйлийг тайлбарласан болно:

-   Функц гэж юу вэ, тэд хэрхэн ажилладаг талаар

-   Функцын аргументууд гэж юу болох талаар

-   Тодорхой функцийг ойлгоход хэрхэн тусламж авах талаар

*Синтаксийн талаархи товч тэмдэглэл:* Энэхүү гарын авлагад функцуудыг код-текст маягаар нээлттэй хаалт бүхий бичсэн болно, жишээ нь: `filter()`. [Багцууд](#packages) хэсэгт тайлбарласны дагуу функцуудыг *багцууд* дотор татаж авдаг. Энэхүү гарын авлагад багцын нэрийг **dplyr** гэж байгаа шиг тодоор (**bold**) бичсэн. Заримдаа жишээ код дээр та функцын нэрийг багцын нэртэй хоёр цэгээр (`::`) буюу ийм байдлаар `dplyr::filter()` холбон бичсэн байхыг харж болно. Энэхүү холболтын зорилгыг [багцууд](#packages) хэсэгт тайлбарласан.

<!-- ======================================================= -->

### Энгийн функцууд {.unnumbered}

**Функц нь оролтыг хүлээн авч, тэдгээр оролтон дээр ямар нэгэн үйлдэл хийж, гаралт гаргадаг машинтай адил юм.** Ямар гаралт байх нь тухайн функцээс хамаарна.

**Функцууд нь ихэвчлэн функцын хаалтанд байрлуулсан зарим объект дээр ажилладаг.** Жишээлбэл, `sqrt()` функц нь тооны квадрат язгуурыг тооцоолно:

```{r basics_function_sqrt}
sqrt(49)
```

Мөн функцэд оруулж буй объект нь датасетийн багана байж болно (бүх төрлийн объектуудын талаар дэлгэрэнгүйг [Объектууд](#objects) хэсгээс үзнэ үү). R нь олон тооны датасет хадгалах боломжтой тул та датасет болон баганыг хоёуланг нь зааж өгөх хэрэгтэй. Үүнийг хийх нэг арга бол \$ тэмдэглэгээг ашиглан датасетийн нэр болон баганын нэрийг (`dataset$column`) холбох юм. Доорх жишээн дээр `linelist` хэмээх датасетийн `age` хэмээх тоон баганыг `summary()` функцэд оруулснаар тухайн баганы тоон болон дутуу утгуудын хураангуй мэдээлэл гарч байна.

```{r basics_functions_summary}
# 'linelist' датасетийн 'age' баганы хураангуй статистикүүдийг хэвлэх 
summary(linelist$age)
```

[***ТЭМДЭГЛЭЛ:*** Хөшигний цаана функц нь хэрэглэгчдэд зориулж нэг хялбар командад багтаасан комплекс нэмэлт кодуудын бүрдэл байдаг.]{style="color: black;"}

<!-- ======================================================= -->

### Олон аргументтай функцууд {.unnumbered}

Функцууд нь ихэвчлэн таслалаар хоорондоо тусгаарлагдсан, функцын хаалтан дотор байрлах ***аргумент*** гэж нэрлэгддэг хэд хэдэн оролтыг шаарддаг.

-   Зарим аргумент функцыг ажиллуулахын тулд заавал шаардлагатай байдаг бол зарим нь заавал байх шаардлагагүй

-   Заавал байх шаардлагагүй аргументууд нь анхдагч утгатай байдаг

-   Аргументууд нь тэмдэгт (character), тоон, логик (ҮНЭН/ХУДАЛ) болон бусад оролтыг авч болно

Энд ердийн функцийн жишээ болгон `oven_bake()` гэсэн зохиомол функц байна. Энэ функц нь оролтын объектыг (жишээлбэл, датасет эсвэл энэ жишээнд байгаа шиг "dough") авч, нэмэлт аргументуудаар тодорхойлсон (`minutes =` ба `temperature =`) үйлдлүүдийг гүйцэтгэж байна. Гаралтыг консол дээр шууд хэвлэх эсвэл оноох операторыг (\<-) ашиглан объект болгон хадгалах боломжтой .

```{r basics_functions_image, echo=F, out.width = "75%", fig.align = "center"}
knitr::include_graphics(here::here("images", "Function_Bread_Example.png"))
```

**Илүү бодитой жишээ дурдвал** доорхи `age_pyramid()` команд нь тодорхой насны бүлгүүд болон `gender` гэх мэт хоёртын баганууд дээр үндэслэн насны пирамидын зургийг гаргадаг. Энэхүү функцэд хаалтан дотор нь таслалаар тусгаарлагдсан гурван аргумент өгөгдсөн байна. Аргументэд өгсөн утгууд нь `linelist`-ийг ашиглах датафрэймээр, `age_cat5`-ийг тоолох баганаар, `gender`-ийг пирамидыг өнгөөр хуваахад ашиглах хоёртын баганаар ашиглаж байна.

```{r basics_functions_arguments, include=FALSE, results='hide', message=FALSE, warning=FALSE,}
## категорийн завсар үүсгэх байдлаар насны бүлгийн хувьсагч үүсгэх
linelist$age_group <- cut(linelist$age, breaks = c(0, 5, 10, 15, 20, 30, 45, 60))
```

```{r message=FALSE, warning=FALSE,  out.width = "75%", out.height="75%"}
# насны пирамид зурах
age_pyramid(data = linelist, age_group = "age_cat5", split_by = "gender")
```

Дээрх командыг аргумент бүр шинэ мөрөн дээр байх замаар урт болгон доорхтой адилаар бичиж болно. Ингэж кодоо бичих нь уншихад илүү хялбар, хэсэг тус бүрийг тайлбарлахын тулд `#`-тэй "тайлбар" бичихэд илүү хялбар болгодог (дэлгэрэнгүй тайлбар хийж явах нь сайн практик!). Энэхүү урт командыг ажиллуулахын тулд та тушаалыг бүхэлд нь тодруулан "Run" дээр дарах эсвэл курсороо эхний мөрөнд байрлуулаад Ctrl, Enter товчлууруудыг нэгэн зэрэг дарж болно.

```{r message=FALSE, warning=FALSE,  out.width = "75%", out.height="75%"}
# насны пирамид зурах
age_pyramid(
  data = linelist,        # тохиолдлын linelist хэрэглэх
  age_group = "age_cat5", # насны бүлгийн баганыг зааж өгөх
  split_by = "gender"     # 2 талтай пирамид зурахын тулд хүйсийн баганыг ашиглах
  )
```

Аргументыг тодорхой дарааллаар бичсэн тохиолдолд (функцын баримт бичигт заасны дагуу) тухайн аргументын эхний хагасыг (жишээ нь, `data =`) бичих шаардлагагүй. Доорх код нь дээрхтэй яг ижил пирамид үүсгэдэг, учир нь энэхүү функц нь датафрэйм, `age_group` хувьсагч, `split_by` хувьсагчийн аргументуудыг яг ийм дараалалтайгаар хүлээж байдаг.

```{r, basics_functions_pyramid2, eval = FALSE, warning=FALSE, message=FALSE, , out.width = "75%", out.height="75%", eval=F}
# Энэ команд нь дээрхтэй яг ижил график үүсгэх болно
age_pyramid(linelist, "age_cat5", "gender")
```

**Илүү комплекс `age_pyramid()` команд нь заавал шаардлагагүй дараахь аргументуудыг агуулж болно:**

-   Тооны оронд пропорцыг харуулах (анхдагч утга нь `FALSE` үед `proportional = TRUE` гэж өөрчилнө)

-   Ашиглах хоёр өнгийг тодорхойлох (`pal =` гэдэг нь "palette" гэсэн үгийн товчлол бөгөөд хоёр өнгөний нэр бүхий вектороор хангагдсан байна. `c()` функц хэрхэн вектор үүсгэдэгийг [объектууд](#objectstructure) хуудаснаас үзнэ үү)

[***ТЭМДЭГЛЭЛ:*** Аргументийн хоёр хэсгийг хоёуланг нь зааж өгсөн (жишээ нь `proportional = TRUE`) үед тухайн аргумент дарааллын хувьд хаана байрлах нь хамаагүй болно.]{style="color: black;"}

```{r message=FALSE, warning=FALSE, out.width = "75%", out.height="75%"}
age_pyramid(
  linelist,                    # тохиолдлын linelist хэрэглэх
  "age_cat5",                  # насны бүлгийн багана
  "gender",                    # хүйсээр хуваах
  proportional = TRUE,         # тооны оронд хувь хэрэглэх
  pal = c("orange", "purple")  # өнгөнүүд
  )
```

<!-- ======================================================= -->

### Функц бичих {.unnumbered data-link="Writing functions"}

R бол функцэд чиглэсэн хэл тул та өөрийн функцийг бичих мэдлэгийг эзэмшсэн байх ёстой. Өөрөө функц бичих нь хэд хэдэн давуу талтай:

-   Модульчлагдсан програмчлалыг хөнгөвчлөх - кодыг бие даасан, удирдах боломжтой хэсгүүдэд хуваадаг

-   Алдаа гаргах магадлал өндөртэй байдаг давтагдсан copy, paste хийхийг орлох

-   Кодын хэсгүүдэд мартагдахааргүй нэр өгөх

Функцийг хэрхэн бичих талаар Функц бичих хуудсан дээр дэлгэрэнгүй авч үзсэн болно.

<!-- A function is given a name and defined with the assignment operator `<-` to a special **base** R function called `function()`. Within the parentheses, the arguments that the function will accept are defined. This is followed by curly brackets `{ }`, within which the actual code of the function is written.     -->

```{r, eval=F, echo=F}
my_function <- function( ЭНД АРГУМЕНТУУД ){ ЭНД КОД }
```

<!-- The arguments should be provided in the syntax `argument = default`, separated by commas.   -->

<!-- Here is an example where we create a function `staff_calc()` to serve as a staffing calculator for COVID-19 case investigation and contact tracing calls.   -->

<!-- The arguments (inputs) and their default values will be:   -->

<!-- * `daily_cases = NULL` The number of new COVID-19 cases per day   -->

<!-- * `contacts_each = 5` The number contacts enumerated for each case   -->

<!-- * `time_case = 0.5`  Number of hours to complete a case investigaton by phone   -->

<!-- * `time_contact = 0.25`  Number of hours to complete a contact follow-up by phone   -->

<!-- * `time_day = 8` The number of hours one staff works per day   -->

<!-- Below, the function is created. The code ends with the special function `return()`, which is what the function produces.    -->

<!-- ```{r message=FALSE, warning=FALSE, out.width = "75%", out.height="75%"} -->

<!-- staff_calc <- function(daily_cases = NULL, contacts_each = 5, -->

<!--                        time_case = 0.5, time_contact = 0.25, time_day = 8){ -->

<!--   # Define total daily hours for calling cases -->

<!--   case_hours <- daily_cases * time_case  -->

<!--   # Define total daily hours for calling contacts -->

<!--   contact_hours <- daily_cases * contacts_each * time_contact -->

<!--   # Calculate number of staff required -->

<!--   staff_required <- (case_hours + contact_hours)/time_day -->

<!--   return(staff_required) -->

<!-- } -->

<!-- ``` -->

<!-- Once this code is run, the function will be defined and will appear in the R Environment. We can run the function. Below all the default values are used and the `daily_cases = ` is set to 150.   -->

```{r eval=F, echo=F, message=FALSE, warning=FALSE, out.width = "75%", out.height="75%"}
staff_calc(daily_cases = 150)
```

```{r, eval=F, echo=F}
case_incidence <- tibble(
  dates = seq.Date(from = as.Date("2020-05-01"), to = as.Date("2020-05-21"), by = 1),
  projected_incidence = c(102,110,50,37,106,190,146,138,135,111,60,43,189,184,185,80,44,97,254,291,288),
  staff_needed = staff_calc(projected_incidence)
)

ggplot(case_incidence, aes(x = dates))+
  geom_line(aes(y = projected_incidence))+
  geom_line(aes(y = staff_needed))
```

<!-- There are many other nuances to understand when writing functions, as discussed in the page [Writing functions].   -->

<!-- ======================================================= -->

<!-- ======================================================= -->

## Багцууд {#packages}

**Багцууд нь функцуудээс бүрддэг.**

R багц гэдэг нь урьдчилан тодорхойлсон функцуудыг агуулсан код, баримт бичгийн нэгдэл юм. R-ын хэрэглэгчид тодорхой асуудлуудад зориулагдсан багцуудыг үргэлж хөгжүүлж байдаг бөгөөд таны ажилд тусалж чадах багц байгаа нь ч эргэлзээгүй! Та R ашиглах явцдаа хэдэн зуун багцыг суулгаж ашиглах болно.

Анх R суулгахад түгээмэл, энгийн даалгавруудыг гүйцэтгэх чадвартай "**base**" багцууд болон функцууд хамт ирдэг. Гэвч олон R хэрэглэгчид өөрсдийн тусгай функцууд зохион **багц** болгосноор бусад хэрэглэгчид хэрэглэн функцуудын үйл ажиллагааг шалгах боломжтой болдог. Энэхүү гарын авлагад багцын нэрийг **тодоор** бичсэн. R -ын бага зэрэг төвөгтэй талуудын нэг нь тодорхой даалгаврыг биелүүлэхийн тулд олон функц, багцуудаас сонгох явдал байдаг.

### Суулгах, ачаалах {.unnumbered}

Интернетээс компьютер дээрээ татаж авдаг ("суулгадаг") **багцуудад** *функцууд* агуулагдсан байдаг. Багцыг татаж авсны дараа таны "library"-д хадгалагдах болно. Дараа нь та багцаа "ачаалах" замаар тухайн багцын агуулж буй функцыг R ашиглах үедээ хэрэглэх боломжтой.

*Та R-г өөрийн хувийн номын сан гэж бод:* Та багц татаж авахад таны номын сан тухайн багцын функцүүд бүхий шинэ номтой болж байна гэсэн үг, улмаар та тухайн номны функц ашиглахыг хүсэх болгондоо тэр номыг номын сангаасаа зээлэх ("ачаалах") ёстой.

Дүгнээд хэлэхэд: R багцад байгаа функцийг ашиглахын тулд 2 алхамыг хэрэгжүүлэх ёстой:

1.  Багцыг (нэг удаа) **суулгасан (installed)** байх ёстой

2.  Багцыг **ачаалах (load)** ёстой (R ашиглах бүртээ)

#### Таны номын сан (library) {.unnumbered}

Таны "номын сан" нь үнэндээ таны компьютер дээр суулгагдсан багц бүрийн хавтсыг агуулсан хавтас юм. R таны компьютерт хаана суусан болохыг олж мэдээд "win-library" нэртэй хавтас хайж олоорой. Жишээ нь: `R\win-library\4.0` (4.0 бол R-ын хувилбар юм. Таны татаж авсан R-ын хувилбар бүр өөрийн номын сантай).

Та `.libPaths()` (хоосон хаалттай) функцыг R консол дээр ажиллуулснаар таны номын сангийн файлын байршлыг харах боломжтой. Ялангуяа \[сүлжээний хөтчүүд дээр R\]-тай ажиллахад энэ нь онцгой ач холбогдолтой.

#### CRAN-аас суулгах {.unnumbered}

Ихэнх тохиолдолд R хэрэглэгчид CRAN-аас багц татаж авдаг. CRAN (Comprehensive R Archive Network - R-ын цогц архивын сүлжээ) нь R хэрэглэгчдийн нийтэлсэн R багцын олон нийтийн, онлайн агуулах юм.

CRAN-аас багц татаж авахдаа вирус, аюулгүй байдлын талаар санаа зовж байна уу? Энэ сэдвээр [энэ нийтлэлийг](https://support.rstudio.com/hc/en-us/articles/360042593974-R-and-R-Package-Security) уншина уу.

#### Хэрхэн суулгаж, ачаалах вэ? {.unnumbered}

Энэхүү гарын авлагад бид **pacman** багцыг ашиглахыг санал болгож байна ("package manager" гэсэн үгийн товчлол). Энэхүү багц нь хэрэглэхэд хялбар `p_load()` хэмээх функцтэй бөгөөд энэхүү функц нь шаардлагатай бол багцыг суулгаж, одоогийн R сесст ачаалдаг.

Синтакс нь маш энгийн. Хэрэглэх багцуудын нэрийг таслалаар тусгаарлан `p_load()` функцын хаалтанд жагсаан бичнэ. Доорх команд нь **rio**, **tidyverse** болон **here** багцуудыг хараахан суулгаагүй байвал суулгаж, ашиглахаар ачаалах болно. Ингэснээр `p_load()` ашиглах арга нь скриптээ бусадтай хуваалцахыг хялбар, тодорхой болгодог. Багцын нэрүүдийн үсгийн том, жижгийн хэмжээ чухал гэдгийг анхаарна уу.

```{r}
# Хэрэглэх багцуудыг (хэрэв шаардлагатай бол) суулгаад ачаалах
pacman::p_load(rio, tidyverse, here)
```

Бид функцийн нэр (`p_load()`)-ийн өмнө багцын нэрийг (**pacman**) хоёр цэгээр `::` холбон бичдэг `pacman::p_load()` синтаксыг ашигласан болохыг анхаарна уу. Энэ синтаксыг ашигласнаар **pacman** багцыг (өмнө нь суулгасан үед) шууд ачаалж байгаа тул амар байдаг.

Та мөн **base** R-ын алтернатив функцуудыг түгээмэл харах болно. Багц суулгах **base** R функц нь `install.packages()` юм. Суулгах багцын нэрийг хаалтнд *ишлэл* доторбичих ёстой. Хэрэв та нэг командаар олон багц суулгахыг хүсвэл тэдгээрийг `c()` тэмдэгтийн вектор дотор жагсаан бичнэ.

Тэмдэглэл: энэ команд нь багцыг *суулгадаг* боловч одоогийн сешн дээр ашиглахаар ачаалдаггүй.

```{r, eval=F}
# base R ашиглан нэг багц суулгах
install.packages("tidyverse")

# base R ашиглан олон багц суулгах
install.packages(c("tidyverse", "rio", "here"))
```

Мөн point-and-click замаар багц суулгая гэвэл RStudio-ийн "Packages" таб дээр очоод "Install" дээр дарж хүссэн багцын нэрийг хайж олон суулгаж болдог.

Суулгасны дараа багцыг ашиглахаар **ачаалах base** R функц нь `library()` юм. Энэ функц нь нэг удаад зөвхөн нэг багцыг ачаалах боломжтой (`p_load()` ашиглах өөр нэг шалтгаан). Та багцын нэрийг ишлэлтэй эсвэл ишлэлгүйгээр өгөх боломжтой.

```{r, eval=F}
# base R ашиглан багц ачаалах
library(tidyverse)
library(rio)
library(here)
```

Багц суулгасан ба/эсвэл ачаалагдсан эсэхийг шалгахын тулд RStudio дахь Packages табыг үзэх боломжтой. Хэрэв багцыг суулгасан бол хувилбарын дугаараар тэнд харуулна. Хэрэв багцын өмнөх хайрцаг тэмдэглэгдсэн байвал тухайн багц нь одоогийн сешнд ачаалагдсан байна гэсэн үг.

**Github-аас суулгах**

Зарим тохиолдолд CRAN-д хараахан байхгүй байгаа багцыг суулгах шаардлагатай болдог. Эсвэл тодорхой багц CRAN дээр байгаа боловч тэрхүү илүү тогтвортой CRAN дээрх хувилбарт хараахан орж ирээгүй байгаа шинэ боломжуудтай *хөгжлийн хувилбарыг* хэрэглэх шаардлага гарч магад юм. Эдгээр нь ихэвчлэн [github.com](https://github.com/) вэбсайт дээр олон нийтэд нээлттэй, үнэгүй кодын "репозитор"-д байршиж байдаг. Github-ын талаар дэлгэрэнгүйг гарын авлагын \[Хувилбарын хяналт ба Git, Github ашиглан хамтран ажиллах\] хуудаснаас уншина уу.

Github-аас R багц татаж авахын тулд та **pacman** багцын `p_load_gh()` функцийг ашиглаж болох бөгөөд энэ функц нь шаардлагатай бол багцыг суулгаж, одоогийн R сешнд ашиглах боломжтой болгон ачаалах болно. Өөрөөр **remotes** эсвэл **devtools** багцыг ашиглан Github-аас багц суулгах боломжтой. **pacman** багцын бүх функцын талаар [багцын баримт бичгээс](https://cran.r-project.org/web/packages/pacman/pacman.pdf) уншина уу.

Github-аас багц суулгахын тулд та дараах мэдээлэлтэй байх шаардлагатай:

1.  Репозитор эзэмшигчийн Github ID

2.  Багцыг агуулсан репозиторын нэр

3.  *(заавал биш) Татаж авахыг хүсч буй "салбар"-ын нэр (хөгжлийн тусгай хувилбар)*

Доорх жишээнүүдэд ишлэл дэх эхний үг бол репозитор эзэмшигчийн Github ID бөгөөд ташуу зураасны дараа репозиторын нэр (багцын нэр) байгаа болно.

```{r, eval=F}
# epicontacts багцыг Github репозитороос нь суулгах/ачаалах
p_load_gh("reconhub/epicontacts")
```

Хэрэв та үндсэн салбараас өөр "салбар" (хувилбар) суулгахыг хүсвэл репозиторын нэрний ард "\@" тэмдгийн дараа салбарын нэрийг нэмнэ үү.

```{r, eval=F}
# epicontacts багцын "timeline" салбарыг Github-аас суулгах/ачаалах
p_load_gh("reconhub/epicontacts@timeline")
```

Хэрэв Github хувилбар болон таны компьютер дээрх хувилбаруудын хооронд ялгаа байхгүй бол ямар ч үйлдэл явагдахгүй. Та `p_load_current_gh()` функцыг `update = TRUE` аргументтэй ашиглан "хүчээр" дахин суулгаж болно. **pacman** тухай нэмэлтээр энэхүү [онлайн винетээс](http://trinker.github.io/pacman/vignettes/Introduction_to_pacman.html) уншина уу.

**ZIP эсвэл TAR файлаас суулгах**

Та URL ашиглан багцыг суулгаж болно:

```{r, eval=F}
packageurl <- "https://cran.r-project.org/src/contrib/Archive/dsr/dsr_0.2.2.tar.gz"
install.packages(packageurl, repos=NULL, type="source")
```

Эсвэл үүнийг зип файл хэлбэрээр компьютер дээрээ татаж аваад:

Сонголт 1: **remotes** багцын `install_local()` функц ашиглан

```{r, eval=F}
remotes::install_local("~/Downloads/dplyr-master.zip")
```

Сонголт 2: **base** R-ын `install.packages()` ашиглан, `type = "source"`, `repos = NULL` хэмээн зааж файлын байршлыг ZIP файлд өгнө.

```{r, eval=F}
install.packages("~/Downloads/dplyr-master.zip", repos = NULL, type = "source")
```

### Кодын синтакс {.unnumbered}

Энэхүү гарын авлагад ойлгомжтой болгох үүднээс зарим тохиолдолд функцүүдийн өмнө `::` тэмдгийг ашиглан багцынх нь нэрийг дараах байдлаар бичсэн: `package_name::function_name()`

Багцыг тухайн сешнд ачаалсны дараа багцыг ингэж зааж өгөх шаардлагагүй байдаг. Та зүгээр л `function_name()` ашиглаж болно. Гэсэн хэдий ч нэг функцын нэр нийтлэг хэлбэрээр олон багцад байж болдог бөгөөд энэ тохиолдолд багцын нэрийг бичиж дуудах нь тустай байдаг (жишээ нь `plot()`). Мөн багцын нэрийг ингэж бичихэд хэрэв тухайн багц ачаалагдаагүй байгаа бол багцыг ачаалах болно.

```{r eval=FALSE}
# Энэ команд "rio" багцыг ашиглан түүний "import()" функцыг ашиглан датасет импорт хийж байна
linelist <- rio::import("linelist.xlsx", which = "Sheet1")
```

### Функцын тусламж {.unnumbered}

Тодорхой функцийн талаар дэлгэрэнгүй уншихын тулд та RStudio-ийн баруун доод хэсэгт байрлах Help таб дээрээс хайх боломжтой. Та мөн `?thefunctionname` (асуултын тэмдгийн дараа функцийн нэрийг оруулна) гэсэн командыг ажиллуулснаар тухайн функцын тусламжийн хуудас нь Help таб дээр гарч ирнэ. Мөн онлайнаар тусламж хайж үзээрэй.

### Багц шинэчлэх {.unnumbered}

Та багцыг дахин суулгах замаар шинэчлэх боломжтой. Та мөн RStudio-ийн Packages таб дээрх ногоон "Update" товчийг дарж аль багцууд шинэ хувилбартай болсныг харж болно. Багц шинэчлэх үед тодорхой функц хэрхэн ажилладаг талаар томоохон өөрчлөлт орсон тохиолдолд хуучин кодоо шинэчлэх шаардлагатай болж магадгүйг анхаарна уу!

### Багц устгах {.unnumbered}

**pacman** багцын `p_delete()` эсвэл **base** R-ын `remove.packages()` функц ашиглана уу. Эсвэл өөрийн library агуулсан хавтсыг компьютер дээрээ олоод багцын хавтсыг гараар устгаж болно.

### Хамааралт багц {.unnumbered}

Багцууд нь ажиллахын тулд ихэвчлэн бусад багцуудыг ашигладаг. Эдгээрийг хамааралт багц (dependencies) гэж нэрлэдэг. Хэрэв хамааралт багцыг суулгаж чадахгүй бол үүнээс хамаарсан багцыг мөн суулгаж чадахгүй байж магадгүй юм.

Тухайн багцын хамааралт багцуудыг `p_depends()` функц ашиглан харах ба `p_depends_reverse()` ашиглан тухайн багцад ямар багцууд хамааралтай болохыг харж болно.

### Далдлах функцууд {.unnumbered}

Хоёр ба түүнээс дээш багц ижил нэртэй функц агуулах нь түгээмэл тохиолддог. Жишээлбэл, **dplyr** багц нь `filter()` функцтэй байхад **stats** багц ч мөн ижил нэртэй функцтэй. Өгөгдмөл (default) `filter()` функц нь эдгээр багцыг R сешнд ачаалах дарааллаас хамаарна - хамгийн сүүлд ачаалагдсан `filter()` өгөгдмөл болох болно.

Та энэхүү дарааллыг R Studio-ийн Environment табаас шалгаж болно - "Global Environment" гэсэн цэсийг дарж, багцын дарааллыг харна уу. Энэ жагсаалтын *доод хэсэгт* байгаа багцын функцууд нь жагсаалтын дээд хэсэгт байгаа багцуудын ижил нэртэй функцийг далдлах болно. Тодорхой багцыг анх ачаалах үед тухайн багцын функц өөр багцын функцийг далдалж байгаа тохиолдолд R консол дээр танд анхааруулах боловч үүнийг анзаарахгүй өнгөрөх нь элбэг байдаг.

```{r out.width = "50%", fig.align = "center", echo=F}
knitr::include_graphics(here::here("images", "masking_functions.png"))
```

Далдлалтыг засах дараах аргууд байна:

1.  Командад багцын нэрийг зааж өгнө. Жишээлбэл, `dplyr::filter()` ашиглах.

2.  Багцыг ачаалах дарааллыг өөрчлөөд (жишээ нь `p_load()` дотор), **шинэ R сешн эхлүүлнэ**.

### Салгах/буулгах {.unnumbered}

Багцыг салгахын (буулгахын) тулд багцын нэрийг зөвөөр, зөвхөн нэг тодорхойлох цэгтэйгээр энэ командыг бичнэ. Энэ нь далдлах асуудлыг шийдэж чадахгүй байж болохыг анхаарна уу.

```{r, eval=F}
detach(package:PACKAGE_NAME_HERE, unload=TRUE)
```

### Хуучин хувилбар суулгах {.unnumbered}

Тодорхой багцын хуучин хувилбарыг суулгахын тулд энэ [зааврыг](https://support.rstudio.com/hc/en-us/articles/219949047-Installing-older-versions-of-packages) үзнэ үү.

### Санал болгож буй багцууд {.unnumbered data-link="Suggested packages"}

Өдөр тутмын тархвар судлалын ажилд санал болгож буй багцуудын жагсаалтыг \[Санал болгож буй багцуудын\] хуудаснаас үзнэ үү.

<!-- ======================================================= -->

## Скриптүүд {#scripts}

Скрипт бол програмчлалын үндсэн хэсэг юм. Скрипт гэдэг нь таны командуудыг (жишээ нь датасет үүсгэх, өөрчлөх, дүрслэлийг харуулах функцууд гэх мэт) хадгалдаг баримт бичиг юм. Та скриптийг хадгалаад дараа нь дахин ажиллуулж болно. Скриптэд командуудаа хадгалаад дараа нь скриптээсээ шууд ажиллуулах нь олон давуу талтай байдаг (командуудаа R консол "command line" дээр нэг нэгээр нь бичихийн оронд).

-   Зөөвөрлөх чадвар - та скриптүүдээ илгээх замаар бусадтай хуваалцах боломжтой

-   Давтагдах чадвар - ингэснээр та болон бусад хүмүүс таны яг юу хийснийг мэдэх боломжтой

-   Хувилбарын хяналт - ингэснээр та өөрийн эсвэл хамтран ажиллагсдын хийсэн өөрчлөлтийг хянах боломжтой

-   Тайлбар/тэмдэглэл - хийсэн зүйлээ хамтран ажиллагсаддаа тайлбарлах

### Тайлбар бичих {.unnumbered}

Скрипт дээр та R кодынхоо эргэн тойронд тэмдэглэл ("тайлбар") оруулах боломжтой. Тайлбар бичих нь юу хийж байгаагаа ирээдүйн өөртөө болон бусад кодыг тань хэрэглэгчдэд тайлбарлахад тустай. Та чагт тэмдгийг (#) бичээд дараа нь тайлбараа бичиж болно. Тайлбарласан текст нь R кодоос өөр өнгөөр харагдах болно.

#-тэмдгээс хойш бичигдсэн аливаа код ажиллахгүй. Тиймээс кодын өмнө \# оруулах нь та устгахыг хүсэхгүй байгаа кодын мөрийг түр хаахад ("comment out") ашигладаг арга юм. Та олон кодын мөрийг нэг дор тодруулж Ctrl+Shift+c (Mac дээр Cmd+Shift+c) товчийг дарснаар түр хааж/нээж болно.

```{r, eval = F}
# Тайлбар нь нэг мөрөнд дангаараа байж болно
# дата импортлох
linelist <- import("linelist_raw.xlsx") %>%   # тайлбар кодын дараа бас орж болно
# filter(age > 50)                          # Үүнийг мөн тодорхой кодын мөрийг идэвхгүй болгох/хасахад ашиглаж болно 
  count()

```

-   *Юу* хийж байгаагаа, **яагаад** хийж байгаагаа тайлбарлах.

-   Кодыг логиктой хэсгүүдэд хуваах

-   Өөрийн хийж буй зүйлийн алхам тус бүрийн тайлбарыг кодтойгоо дагалдуулах (жишээлбэл дугаарласан алхамууд)

### Загвар {.unnumbered}

Кодлох загварынхаа талаар тодорхой бодолтой байх нь чухал, ялангуяа багаар ажиллаж байгаа бол. Бид **tidyverse** [загварын зааврын](https://style.tidyverse.org/) дагуу кодоо бичихийг зөвлөж байна. Мөн энэ загварт нийцэхэд тань туслах **styler**, **lintr** гэх мэт багцууд байдаг.

Таны кодыг бусад хүн уншихад хялбар болгох цөөн хэдэн зөвлөмж:

-   Объектуудыг нэрлэхдээ зөвхөн жижиг үсэг, тоо, доогуур зураас `_` ашиглах, жишээ нь `my_data`

-   Space буюу зайг сайн ашиглах, операторуудыг тойруулаад `n = 1` ба `age_new <- age_old + 3` гэх мэт

### Жишээ скрипт {.unnumbered}

Богино R скриптийн жишээг доор харуулав. Та кодоо товч, ойлгомжтой тайлбарлах тусам хамтран ажиллагсад тань танд талархах болно гэдгийг санаарай!

```{r out.width = "100%", fig.align = "center", echo=F}
knitr::include_graphics(here::here("images", "example_script.png"))
```

<!-- ======================================================= -->

### R markdown {.unnumbered}

R markdown скрипт бол тухайн скрипт нь өөрөө гаралтын баримт бичиг (PDF, Word, HTML, Powerpoint гэх мэт) болдог R скриптийн төрөл юм. Эдгээр нь динамик, автомат тайланг гаргахад ихэвчлэн хэрэглэгддэг маш хэрэгцээтэй, олон талын хэрэгсэл юм. Энэ вэбсайт, гарын авлагыг хүртэл R markdown скриптээр хийдэг!

R анхлан сурж буй хэрэглэгчид ч R Markdown-ийг ашиглаж болно гэдгийг хэлэх нь зүйтэй - сүрдэх зүйл байхгүй! Нэмж суралцахын тулд \[R Markdown тайлан\] хэмээх гарын авлагын хуудсыг үзнэ үү.

<!-- ======================================================= -->

### R notebook {.unnumbered}

R markdown болон R notebook бичих хоёрын хооронд ялгаа байхгүй. Гэсэн хэдий ч ажиллагааны хувьд бага зэрэг ялгаатай байдаг. Дэлгэрэнгүй мэдээллийг энэ [сайтаас](http://uc-r.github.io/r_notebook) үзнэ үү.

<!-- ======================================================= -->

### Shiny {.unnumbered}

Shiny апп/вэбсайтууд нь `app.R` гэсэн нэртэй нэг скрипт дотор агуулагддаг. Энэ файл нь гурван бүрэлдэхүүн хэсэгтэй:

-   Хэрэглэгчийн интерфэйс (ui)

-   Серверийн функц

-   `shinyApp` функцын дуудлага

\[Shiny хяналтын самбар\] хэмээх гарын авлагын хуудсыг эсвэл энэ онлайн хичээлийг үзнэ үү: [Shiny хичээл](https://shiny.rstudio.com/tutorial/written-tutorial/lesson1/)

*Өмнө нь дээрх файлыг хоёр файл болгон хуваадаг байсан (`ui.R` ба `server.R`).*

### Код эвхэх {.unnumbered}

Та өөрийн скриптийг уншихад хялбар болгохын тулд кодын хэсгийг эвхэж болно.

Үүнийг хийхийн тулд \# ашиглан текстийн гарчиг үүсгэж, гарчгаа бичээд зураас (-), чагт ( #) эсвэл тэнцүү (=) гэсэн тэмдгийг 4-ээс доошгүйг бичнэ. Ингэхэд зүүн талын "суваг" хэсэгт жижиг сум гарч ирнэ (мөрний дугаарын хажууд). Та энэ сум дээр дарахад гарчгийн доорх кодоос дараагийн гарчиг хүртэл эвхэгдэж оронд нь хоёр толгойтой сум гарч ирэх болно.

Кодыг дэлгэхийн тулд суваг дээрх сум эсвэл хоёр толгойтой сумны дүрс дээр дахин дарна. Энэ хуудасны [RStudio хэсэгт](#rstudio) тайлбарласан шиг гарын товчлолууд бас байдаг.

Чагт (#) ашиглан гарчиг үүсгэснээр та скриптийнхээ доод хэсэгт Агуулгын хүснэгтийг идэвхжүүлэх болно (доороос үзнэ үү). Та \# тэмдгийг нэмж дэд гарчгууд үүсгэж болно, жишээ нь \# нэгдүгээр шатны, ## хоёрдугаар шатны, ##\# гуравдугаар шатны гарчиг гэх мэт.

Жишээ скриптийн хоёр хувилбарыг доор харуулав. Зүүн талд тайлбарласан гарчгууд бүхий эх хувь байна. Баруун талд гарчиг тус бүрийн ард дөрвөн зураас бичин тэдгээрийг эвхэгддэг болгосон. Тэдгээрийн хоёр нь эвхэгдсэн байгаа бөгөөд та доорх Агуулгын хүснэгтэд хэсэг бүрийг харуулсныг харж болно.

```{r, out.width = c('50%'), fig.show='hold', echo=F}
knitr::include_graphics(here::here("images", "code_folding1.png"))
knitr::include_graphics(here::here("images", "code_folding2.png"))
```

Автоматаар эвхэх боломжтой кодын бусад хэсэгт функцүүдийн тодорхойлолт зэрэг `{ }` хаалт бүхий "braced" бүсүүд эсвэл нөхцөлт блокууд (if else statements) орно. Та код эвхэх тухай дэлгэрэнгүй мэдээллийг RStudio [сайтаас](https://support.rstudio.com/hc/en-us/articles/200484568-Code-Folding-and-Sections) уншиж болно.

<!-- ======================================================= -->

<!-- ======================================================= -->

<!-- ======================================================= -->

## Ажлын директор

Ажлын директор нь R таны ажилд ашигладаг үндсэн хавтасны байршил бөгөөд R нь энэ хавтас дотор файлуудыг хайж, хадгалдаг. Зориудаар өөрчлөөгүй үед шинэ файлууд болон үр дүнг энэ байршилд шууд хадгалах бөгөөд эндээс импортлох файлуудыг (жишээ нь, датасет) мөн хайх болно.

Ажлын директор нь RStudio Console самбарын дээд талд саарал текстээр харагдана. Та мөн `getwd()` функцыг (хашилтыг хоосон орхи) ажиллуулснаар одоогийн ашиглаж байгаа директорийг харж болно .

```{r out.width = "100%", fig.align = "center", echo=F}
knitr::include_graphics(here::here("images", "working_directory_1.png"))
```

### Санал болгож буй арга {.unnumbered}

**Та ажлын директорио хэрхэн ашиглах талаар бидний санал болгож буй аргын дэлгэрэнгүйг \[R төслүүд\] хуудаснаас үзнэ үү.**\
Өөрийн ажлын директор болон файлын замыг удирдах нийтлэг, үр дүнтэй, асуудалгүй арга бол эдгээр 3 элементийг \[R project\]\[R projects\]-д чиглэсэн ажлын урсгалд нэгтгэх явдал юм.

1.  Таны бүх файлыг хадгалах R төсөл (\[R төслүүд\] дээрх хуудсыг үзнэ үү)

2.  Файлуудыг олох **here** багц (\[Импорт, экспорт\] дээрх хуудсыг үзнэ үү)

3.  Файлуудыг импортлох/экспортлох **rio** багц (\[Импорт, экспорт\] дээрх хуудсыг үзнэ үү)

<!-- ======================================================= -->

### Командаар тохируулах {.unnumbered}

Саяхныг хүртэл R сурч буй олон хүмүүст `setwd()` командаар скриптээ эхлүүлэхийг заадаг байсан. Оронд нь \[R project\]\[R projects\]-д чиглэсэн ажлын урсгалыг ашиглах талаар бодож үзээд [`setwd()`-г ашиглахгүй байгаа шалтгааныг](https://www.tidyverse.org/blog/2017/12/workflow-vs-script/) уншина уу. Товчхондоо, таны ажил таны хэрэглэж буй компьютертэй хамааралтай болж, файлуудыг импортлох, экспортлоход ашигладаг файлын замууд "хэврэг" болж, бусад компьютер дээр таны кодыг ашиглах, хамтран ажиллахад ихээхэн саад учруулдаг. Үүнээс зайлсхийх өөр хялбар аргууд байна!

Дээр дурдсанчлан бид ихэнх тохиолдолд ийм аргыг хэрэглэхийг зөвлөдөггүй ч та `setwd()` командыг хүссэн хавтасныхаа файлын замыг ишлэл дотор бичсэнээр ашиглаж болно, жишээлбэл:

```{r, eval=F}
setwd("C:/Documents/R Files/My analysis")
```

[***АЮУЛ:*** Хэрэв файлын зам нь нэг компьютерт зориулагдсан бол `setwd()`-аар ажлын директор тохируулах нь "хэврэг" *байж болно*. Үүний оронд R Project-ийн үндсэн директортой харьцангуй холбоотой файлын замуудыг ашиглана уу (**here** багцтай).]{style="color: red;"}

<!-- ======================================================= -->

### Гараар тохируулах {.unnumbered}

Ажлын директорийг гараар тохируулахын тулд (`setwd()`-ийн товч дарахтай дүйцэхүйц) Session унадаг цэсийг товшиж "Set Working Directory", дараа нь "Choose Directory" руу очно уу. Энэ нь тухайн R сессийн ажлын директорийг тохируулах болно. Тэмдэглэл: Хэрэв энэ аргыг хэрэглэж байгаа бол RStudio-г нээх болгондоо үүнийг гараар хийх шаардлагатай болно.

<!-- ======================================================= -->

### R төслийн дотор {.unnumbered}

Хэрэв R төслийг ашиглаж байгаа бол ажлын директор нь ".rproj" файлыг агуулсан R төслийн үндсэн хавтсыг ашиглах болно. Та R Project (".rproj" өргөтгөлтэй файл) дээр дарж RStudio-г нээвэл энэ нь хэрэгжинэ.

<!-- ======================================================= -->

### R markdown-ы ажлын директор {.unnumbered}

R markdown скриптийн үндсэн ажлын директор нь Rmarkdown файлын (.Rmd) хадгалагдаж буй хавтас юм. Хэрэв R төсөл болон **here** багцыг ашиглаж байгаа бол энэ нь хамаарахгүй бөгөөд \[R төслүүд\] хуудсанд тайлбарласны дагуу ажлын директор `here()` байх болно.

Хэрэв та бие даасан (R төсөл дотор биш) R markdown-ы ажлын директорийг `setwd()` ашиглан өөрчлөх гэж байвал энэ нь зөвхөн тухайн кодын хэсэгт хамаарна. R markdown дах бүх кодын хэсгүүдэд өөрчлөлт оруулахын тулд тохиргооны хэсгийг засварлаж `root.dir =` параметрийг доорх жишээ шиг нэмж оруулаарай:

```{r, eval=F}
knitr::opts_knit$set(root.dir = 'desired/directorypath')
```

R markdown-ыг R төслийн дотор **here** багцтай хамт ашиглах нь хамаагүй хялбар юм.

<!-- ======================================================= -->

### Файлын замууд бичих {.unnumbered}

R эхлэн суралцагчдын бухимдлын хамгийн түгээмэл эх үүсвэр (наад зах нь Windows машин дээр) бол магадгүй дата импортлох, экспортлох файлын замыг бичих явдал юм. \[Импорт, экспорт\] хуудсанд файлын замыг хэрхэн хамгийн сайн оруулах талаар дэлгэрэнгүй тайлбар байгаа боловч энд цөөн хэдэн гол санааг дурдав:

**Эвдэрсэн замууд**

Доорх нь "үнэмлэхүй" эсвэл "бүтэн хаяг" файлын замын жишээ юм. Хэрэв өөр компьютер ашиглавал эдгээр нь эвдрэх магадлалтай. Хэрэв та дундын/сүлжээний драйв ашиглаж байгаа бол үүнд хамаарахгүй.

    C:/Users/Name/Document/Analytic Software/R/Projects/Analysis2019/data/March2019.csv  

**Налуу зураасны чиглэл**

*Хэрэв ташуу зураас файлын замд бичиж байгаа бол түүний чиглэлийг анхаараарай.* Бүрэлдэхүүн хэсгүүдийг ("data/provincial.csv") салгахын тулд *урагшаа налуу зураасыг* (`/`) ашиглана уу. Windows хэрэглэгчдийн хувьд файлын замыг *арагшаа налуу зураасаар* (\\) харуулдаг тул та налуу зураас бүрийн чиглэлийг өөрчлөх шаардлагатай болно. Хэрэв та \[R төслүүд\] хуудсанд тайлбарласны дагуу **here** багцыг ашиглавал налуу зураасны чиглэл асуудал болохгүй.

**Харьцангуй файлын замууд**

Бид ерөнхийдөө "харьцангуй" файлын замууд ашиглахыг зөвлөж байна, өөрөөр хэлбэл таны R төслийн үндсэн хавтастай *харьцангуй* холбоотой зам. Та үүнийг \[R төслүүд\] хуудсанд тайлбарласны дагуу **here** багцыг ашиглан хийж болно. Харьцангуй файлын зам дараах байдлаар харагдаж болно:

```{r, eval=F}
# R төслийн data/linelist/clean/ дэд хавтаснаас csv лайнлист импортлох
linelist <- import(here("data", "clean", "linelists", "marin_country.csv"))
```

R төсөл дотор харьцангуй файлын замыг ашиглаж байсан ч та R төслөөс гадуур байгаа датаг үнэмлэхүй зам ашиглан импортолж/экспортолж болно.

<!-- ======================================================= -->

## Объектууд {#objects}

R-д байгаа бүх зүйл нь объект бөгөөд R нь "объект-чиглэлтэй" (object-oriented) хэл юм. Доорх хэсгүүд дараах зүйлсийг тайлбарлах болно:

-   Хэрхэн объект үүсгэх вэ (`<-`)

-   Объектуудын төрлүүд (жишээ нь, датафрэймүүд, векторууд..)

-   Объектуудын дэд хэсгүүдэд (жишээ нь, датасетийн хувьсагчид) хэрхэн хандах вэ

-   Объектуудын ангилал (жишээлбэл, тоон, логик, бүхэл тоо, давхар тоо, тэмдэгт, фактор)

<!-- ======================================================= -->

### Бүх зүйл объект {.unnumbered}

*Энэ хэсгийг [R4Epis төслөөс](https://r4epis.netlify.app/training/r_basics/objects/) ашигласан.*

R-д хадгалагдаж буй бүх зүйл - датасет, хувьсагч, тосгоны нэрсийн жагсаалт, нийт хүн амын тоо, тэр ч байтугай график гэх мэт гаралтууд нь **нэр оноогдсон** **объектууд** бөгөөд эдгээрийг дараагийн командуудад **ашиглаж болдог**.

Тухайн объектод утга оноох үед объект бий болдог (доорх оноолтын хэсгийг үзнэ үү). Түүнд утга оноох үед тухайн объект Environment хэсэгт гарч ирнэ (RStudio-ийн баруун дээд хэсгийг харна уу). Ингэснээр түүнийг ажиллуулж, удирдаж, өөрчилж, дахин тодорхойлж болно.

<!-- ======================================================= -->

### Объектуудыг тодорхойлох (`<-`) {.unnumbered}

**Объектуудад \<- операторын тусламжтайгаар тодорхой утгыг оноож үүсгэнэ.**

Та оноох оператор `<-` -ыг "гэж тодорхойлсон" гэсэн үг гэж бодож болно. Оноолтын командууд нь ерөнхийдөө дараах стандарт дараалалтай байдаг:

**объектын_нэр \<- утга** (эсвэл тодорхой утга үүсгэдэг процесс/тооцоолол)

Жишээлбэл, та одоогийн эпидемиологийн тайлангийн долоо хоногийг дараагийн кодын лавлагааны объект болгон тэмдэглэхийг хүсч байж болох юм. Энэ жишээнд `"2018-W10"` гэсэн утгыг оноох үед `current_week` объект үүсч байна (ишлэл нь үүнийг тэмдэгтийн утга болгодог). Ингэснээр `current_week` объект RStudio Environment хэсэгт (баруун дээд талд) гарч ирэх ба дараагийн командуудад ашиглаж болно.

R командууд болон тэдгээрийн гаралтыг доор харна уу.

```{r basics_objects_assignment}
current_week <- "2018-W10"   # Энэ команд нь утга оноосноор current_week объект үүсгэнэ
current_week                 # Энэ команд нь консол дахь current_week объектын одоогийн утгыг хэвлэнэ 
```

[***ТЭМДЭГЛЭЛ:*** R консолын гаралт дахь \[1\] нь ердөө л таныг гаралтын эхний зүйлийг харж байгааг илэрхийлж байгаа болно.]{style="color: black;"}

[***АНХААРУУЛГА:*** Объектын утгыг дахин тодорхойлох оноолтын командыг ажиллуулснаар ямар ч үед тухайн **объектын өмнөх утгыг дарж шинэ утга оноож болно**. Тиймээс **командуудыг гүйцэтгэх дараалал нь маш чухал** юм.]{style="color: orange;"}

Дараах команд нь `current_week` утгыг дахин тодорхойлох болно:

```{r basics_objects_reassignment}
current_week <- "2018-W51"   # current_week объектод ШИНЭ утгыг онооно 
current_week                 # current_week утгыг консол дээр хэвлэнэ
```

**Тэнцүүгийн тэмдэг `=`**

Та R код дотор тэнцүүгийн тэмдэгтэй олон таарах болно:

-   Хоёр объект эсвэл утгын хоорондох давхар тэнцүүгийн тэмдэг `==` "энэ нь үүнтэй тэнцүү юу?" гэсэн логик *асуултыг* тавьдаг.

-   Та мөн функц дотор функцийн аргументуудын утгыг тодорхойлоход ашигладаг тэнцүүгийн тэмдгийг харах болно (үүний талаар дараагийн хэсгүүдээс уншина уу), жишээ нь `max(age, na.rm = TRUE)`.

-   Мөн та объект үүсгэж, тодорхойлохын тулд `<-`ын оронд `=` нэг тэнцүү тэмдгийг ашиглаж болох боловч энэ үйлдлийг хийхийг бид зөвлөдөггүй. Үүнийг яагаад зөвлөдөггүй талаар [эндээс](https://renkun.me/2014/01/28/difference-between-assignment-operators-in-r/) уншиж болно.

**Датасетүүд**

Датасет нь мөн объект (ихэвчлэн "датафрэйм") бөгөөд тэдгээрийг импортлохдоо нэр өгөх ёстой. Доорх кодонд **rio** багцын `import()` функц ашиглан импортолсон CSV файлын утгыг `linelist` гэсэн объект руу оноож шинээр үүсгэж байна.

```{r basics_objects_dataframes, eval=FALSE}
# linelist-ийг үүсгэж, импортолсон CSV файлын утгыг оноож өгч байна
linelist <- import("my_linelist.csv")
```

Та \[Импорт, экспорт\] хэсгээс датасет импортлох, экспортлох талаар дэлгэрэнгүй унших боломжтой.

[***АНХААРУУЛГА:*** Объектуудыг нэрлэх тухай товч тэмдэглэл:]{style="color: orange;"}

-   Объектын нэрэнд хоосон зай байх ёсгүй, гэхдээ зайны оронд доогуур зураас (\_) эсвэл цэг (.) ашиглаж болно.

-   Объектын нэр нь үсгийн том жижгээр ялгагддаг (Dataset_A нь dataset_A-аас өөр гэсэн үг).

-   Объектын нэр үсгээр эхлэх ёстой (1, 2, 3 гэх мэт тоогоор эхэлж болохгүй).

**Гаралтууд**

Хүснэгт, график гэх мэт гаралтууд нь гаралтыг хэрхэн объект болгон хадгалах, эсвэл хадгалахгүйгээр хэвлэх боломжтой жишээг харуулдаг. **base** R функц болох `table()` ашиглан хүйс, үр дүнгийн хүснэгтийг R консол дээр шууд хэвлэх боломжтой (*хадгалахгүйгээр*).

```{r}
# зөвхөн R консол дээр хэвлэнэ
table(linelist$gender, linelist$outcome)
```

Гэхдээ яг ижил хүснэгтийг нэрлэсэн объект болгон хадгалах боломжтой. Дараа нь хүсвэл үүнийг хэвлэж болно.

```{r}
# хадгал
gen_out_table <- table(linelist$gender, linelist$outcome)

# хэвлэ
gen_out_table
```

**Баганууд**

Датасетийн баганууд нь мөн объектууд бөгөөд "Баганууд" хэсэгт доор тайлбарласны дагуу тодорхойлж, дахин бичиж, шинээр үүсгэж болно.

Та шинэ багана үүсгэхийн тулд **base** R-ын оноолтын операторыг ашиглаж болно. Доорх кодонд мөр бүрийн хувьд `wt_kg` болон `ht_cm` багана дахь мөрийн утгуудыг ашиглан математик үйлдлийн үр дүнд шинэ утга гарган түүнийг шинэ багана `bmi` (Биеийн жингийн индекс) дотор хадгалж байна.

```{r, eval=F}
# base R синтакс ашиглан шинэ "bmi" багана үүсгэнэ
linelist$bmi <- linelist$wt_kg / (linelist$ht_cm/100)^2
```

Хэдий ингэж болох боловч энэхүү гарын авлагад бид багануудыг тодорхойлох өөр арга болох **dplyr** багцын `mutate()` функц болон пайп оператораар (`%>%`) дамжуулан пайплахыг санал болгож байна. Ингэснээр синтаксийг уншихад хялбар бөгөөд \[Дата цэвэрлэх болон үндсэн функцууд\] хуудсанд тайлбарласан бусад давуу талууд байдаг. Та *пайпын* талаар дэлгэрэнгүй мэдээллийг дараах "Пайплах" хэсгээс уншиж болно.

```{r, eval=F}
# dplyr синтакс ашиглан шинэ "bmi" багана үүсгэнэ
linelist <- linelist %>% 
  mutate(bmi = wt_kg / (ht_cm/100)^2)
```

<!-- ======================================================= -->

### Объектын бүтэц {.unnumbered}

**Объектууд нь зөвхөн нэг ширхэг дата байж болно (жишээ нь, `my_number <- 24`) эсвэл тодорхой бүтэцтэй датанаас бүрдэж болно.**

Доорх графикийг [энэхүү онлайн R хичээлээс](http://venus.ifca.unican.es/Rintro/dataStruct.html) авсан болно. Энэ нь зарим нийтлэг дата бүтэц, тэдгээрийн нэрийг харуулж байна. Энэ зурагт орон зайн мэдээлэл ороогүй бөгөөд үүнийг \[GIS-ын суурь\] хуудсанд авч үзсэн болно.

```{r basics_objects_structures, echo=F, out.width = "75%", out.height="50%", fig.align = "center"}
knitr::include_graphics(here::here("images", "R_data_structures.png"))
```

Эпидемиологт (ялангуяа талбарын эпидемиологт) та датафрэймүүд ба векторуудтай хамгийн их тулгарах болно:

| Нийтлэг бүтэц | Тайлбар                                                                                      | Жишээ                                                                                       |
|---------------|----------------------------------------------------------------------------------------------|---------------------------------------------------------------------------------------------|
| Векторууд     | Бүгд ижил ангиллын ганц бие объектуудын дараалалд зориулсан агуулах (жишээ нь тоо, тэмдэгт). | **Датафрэймүүдийн "Хувьсагчид" (баганууд) нь векторууд юм** (жишээ нь: `age_years` багана). |
| Датафрэймүүд  | Бүгд ижил тооны мөртэй, хоорондоо холбогдсон векторууд (жишээ нь багана).                    | `linelist` бол датафрэйм                                                                    |

Датафрэймийн нэг хэсэг биш "дан" вектор үүсгэхийн тулд `c()` функцийг өөр өөр элементүүдийг нэгтгэхэд ашигладаг болохыг анхаарна уу. Жишээлбэл, графикийн өнгөний хуваарь болгон ашиглах өнгөний вектор үүсгэх тохиолдолд : `vector_of_colors <- c("blue", "red2", "orange", "grey")`

<!-- ======================================================= -->

### Объектын ангиуд {.unnumbered}

R-д хадгалагдсан бүх объектууд R-д тухайн объектыг хэрхэн зохицуулахыг хэлдэг ангитай байдаг. Олон боломжит ангиуд байдаг боловч нийтлэг байдаг нь:

| Анги                | Тайлбар                                                                                                                                                                      | Жишээ                                                                                               |
|---------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------|
| Тэмдэгт (character) | Эдгээр нь **"ишлэлийн доторх"** текст/үг/өгүүлбэр юм. Эдгээр объектууд дээр математик үйлдэл хийх боломжгүй.                                                                 | "Тэмдэгтийн объектууд ишлэл дотор байна"                                                            |
| Бүхэл тоо           | Зөвхөн **бүхэл тоо** (аравтын бутархай байхгүй)                                                                                                                              | -5, 14, эсвэл 2000                                                                                  |
| Тоо                 | Эдгээр нь тоо бөгөөд **аравтын бутархайг агуулж болно**. Хэрэв ишлэл дотор байвал тэдгээрийг тэмдэгтийн ангилалд тооцно.                                                     | 23.1 эсвэл 14                                                                                       |
| Фактор              | Эдгээр нь **тодорхой дараалал** эсвэл утгуудын шатлалтай векторууд юм.                                                                                                       | Орлогын түвшний дараалалт утга бүхий хувьсагч                                                       |
| Огноо               | **R-д тодорхой дата нь огноо гэж мэдэгдсэний дараа** эдгээр датаг тусгай аргаар удирдаж, харуулах боломжтой. Дэлгэрэнгүй мэдээллийг \[Огноотой ажиллах\] хуудаснаас үзнэ үү. | 2018-04-12 эсвэл 15/3/1954 эсвэл Wed 4 Jan 1980                                                     |
| Логик               | Утга нь TRUE эсвэл FALSE гэсэн хоёр тусгай утгын нэг байх ёстой (эдгээр нь ишлэл доторх "TRUE" ба "FALSE" биш гэдгийг анхаарна уу)                                           | TRUE эсвэл FALSE                                                                                    |
| data.frame          | Датафрэйм нь R **ердийн датасетийг** хадгалдаг арга юм. Энэ нь бүгд ижил тооны ажиглалттай (мөр) хоорондоо холбогдсон дата векторуудаас (баганууд) бүрдэнэ.                  | `linelist_raw` нэртэй AJS жишээ датасет нь тус бүр 300 ажиглалт (мөр) бүхий 68 хувьсагчийг агуулна. |
| tibble              | tibble нь датафрэймийн хувилбар бөгөөд үйл ажиллагааны гол ялгаа нь консол дээр илүү сайн хэвлэдэг (эхний 10 мөр, зөвхөн дэлгэцэн дээр багтах багануудыг харуулна)           | Ямар ч датафрэйм, лист эсвэл матрицыг `as_tibble()` ашиглан tibble болгон хувиргаж болно.           |
| лист                | Лист нь вектор шиг боловч өөр өөр ангийн объектуудыг агуулж чаддагаараа ялгаатай.                                                                                            | Листэд нэг тоо, датафрэйм, вектор, тэр ч байтугай дотор нь өөр лист ч байж болно!                   |

**Та `class()` функцад нэрийг нь оруулснаар тухайн объектын ангийг шалгаж болно.** Тэмдэглэл: Та `$` тэмдэглэгээг ашиглан датасетийн нэр болон баганын нэрийг тусгаарласнаар тухайн датасет доторх тодорхой баганыг ашиглаж болно.

```{r, echo=TRUE,}
class(linelist)         # анги нь датафрэйм эсвэл tibble байх ёстой

class(linelist$age)     # анги тоон байх ёстой

class(linelist$gender)  # анги тэмдэгт байх ёстой
```

Заримдаа R баганыг автоматаар өөр анги руу хөрвүүлдэг. Үүнээс болгоомжил! Жишээлбэл, хэрэв танд тоонуудын вектор эсвэл багана байгаа боловч тэмдэгтийн утга оруулсан бол... багана бүхэлдээ тэмдэгт ангитай болж өөрчлөгдөнө.

```{r}
num_vector <- c(1,2,3,4,5) # векторыг дан тоогоор тодорхойлно
class(num_vector)          # вектор нь тоон анги
num_vector[3] <- "three"   # гурав дахь элементийг тэмдэгт болгон хувиргана
class(num_vector)          # вектор нь одоо тэмдэгтийн анги болжээ
```

Үүний нэг нийтлэг жишээ бол хүснэгтийг хэвлэхийн тулд датафрэймтэй ажиллах үед - хэрэв та нийт гэсэн мөр гаргаж, тоонуудтай нэг нүдэнд хувийг буулгах/наах (жишээ нь `23 (40%)`) гэж оролдвол дээрх тоон багана нь тэмдэгт болж хувирах бөгөөд цаашид математик тооцоололд ашиглагдах боломжгүй болно. **Тиймээс заримдаа та объект эсвэл баганыг өөр анги руу хөрвүүлэх шаардлагатай болдог.**

| Функц            | Үйлдэл                                                                                                        |
|------------------|---------------------------------------------------------------------------------------------------------------|
| `as.character()` | Тэмдэгт анги руу хөрвүүлдэг                                                                                   |
| `as.numeric()`   | Тоон анги руу хөрвүүлдэг                                                                                      |
| `as.integer()`   | Бүхэл тоон анги руу хөрвүүлдэг                                                                                |
| `as.Date()`      | Огноо анги руу хөрвүүлдэг - Тэмдэглэл: дэлгэрэнгүй мэдээллийг [огнооны](#dates) хэсгээс үзнэ үү               |
| `factor()`       | Фактор анги руу хөрвүүлдэг - Тэмдэглэл: утгын түвшний дарааллыг дахин тодорхойлох нь нэмэлт аргумент шаарддаг |

Үүний нэгэн адил `is.numeric()`, `is.character()`, `is.double()`, `is.factor()`, `is.integer()` зэрэг тодорхой ангиллын объект МӨН эсэхийг шалгах **base** R функцууд байдаг.

[R хэл дээрх анги, датаны бүтцийн талаархи онлайн материалыг](https://swcarpentry.github.io/r-novice-inflammation/13-supp-data-structures/) эндээс үзнэ үү.

<!-- ======================================================= -->

### Баганууд/Хувьсагчид (`$`) {.unnumbered}

**Датафрэйм дэх багана нь техникийн хувьд "вектор" (дээрх хүснэгтийг харна уу)** - бүгд ижил ангитай (тэмдэгт, тоон, логик гэх мэт) байх ёстой утгуудын цуврал юм.

Вектор нь датафрэймээс хамааралгүй оршиж болно, жишээ нь моделд тайлбарлах хувьсагч болгон оруулахыг хүссэн баганын нэрнүүдийн вектор. "Бие даасан" вектор үүсгэхийн тулд дараах байдлаар `c()` функцийг ашиглана уу:

```{r, warning=F, message=F}
# тэмдэгтийн утгууд бүхий бие даасан векторыг тодорхойлно
explanatory_vars <- c("gender", "fever", "chills", "cough", "aches", "vomit")

# энэ нэрлэсэн вектор дахь утгуудыг хэвлэх
explanatory_vars
```

**Датафрэймийн баганууд нь мөн векторууд бөгөөд `$` тэмдэг ашиглан дуудаж, лавлаж, задалж эсвэл шинээр үүсгэж болно.** `$` тэмдэг нь баганын нэрийг датафрэймийн нэртэй холбодог. Энэхүү гарын авлагад бид "хувьсагч" гэхийн оронд "багана" гэсэн үгийг ашиглахыг хичээсэн.

```{r basics_objects_call, eval=F}
# age_years векторын уртыг ол 
length(linelist$age) # (age нь linelist датафрэймийн нэг багана юм)

```

Датафреймийн нэрийн дараа `$` тэмдэг оруулснаар та тухайн датафрэйм дэх бүх баганын унадаг цэсийг харах болно. Та сумны товчийг ашиглан тэдгээрийг гүйлгэж, Enter товчлуураар нэгийг нь сонгосноор зөв бичгийн алдаа гаргахаас зайлсхийх боломжтой!

```{r echo=F, out.width = "100%", fig.align = "center"}
knitr::include_graphics(here::here("images", "Calling_Names.gif"))
```

[***АХИСАН ТҮВШНИЙ ЗӨВЛӨМЖ:*** Зарим илүү комплекс объектууд (жишээ нь лист, эсвэл `epicontacts` объект) олон доллар тэмдэгтээр хандах боломжтой олон түвшинтэй байж болно. Жишээлбэл, `epicontacts$linelist$date_onset`]{style="color: darkgreen;"}

<!-- ======================================================= -->

### Хаалт ашиглан хандах/индекслэх (`[ ]`) {.unnumbered}

Та объектын хэсгүүдийг харах, өөрөөр "индекслэх" гэж нэрлэгддэг, шаардлагатай байж болох бөгөөд үүнийг ихэвчлэн дөрвөлжин хаалт `[ ]` ашиглан хийдэг. Баганад хандахын тулд датафрэйм дээр `$`-г ашиглах нь мөн индекслэлтийн нэг төрөл юм.

```{r}
my_vector <- c("a", "b", "c", "d", "e", "f")  # векторыг тодорхойлно
my_vector[5]                                  # 5-р элементийг хэвлэх
```

Дөрвөлжин хаалт нь `summary()` функцийн гаралт гэх мэт гарч ирсэн гаралтын тодорхой хэсгийг харуулахад ашиглагддаг:

```{r}
# Бүх хураангуй
summary(linelist$age)

# Нэр бүхий, хураангуйн хоёр дахь элемент (зөвхөн ганц хаалт ашиглан) 
summary(linelist$age)[2]

# Нэргүй, хураангуйн хоёр дахь элемент (давхар хаалт ашиглан)
summary(linelist$age)[[2]]

# Нэрийг харуулахгүйгээр элементийг нэрээр нь задлах
summary(linelist$age)[["Median"]]

```

Хаалт нь тодорхой мөр, баганыг харахын тулд датафрэйм дээр ажилладаг. Та үүнийг `датафрэйм[мөр, багана]` синтакс ашиглан хийж болно:

```{r basics_objects_access, eval=F}
# Датасетийн тодорхой мөрийг (2) бүх баганын хамт харах (таслалыг бүү март!) 
linelist[2,]

# Бүх мөрүүдийг харах, гэхдээ зөвхөн нэг баганатай
linelist[, "date_onset"]

# 2-р мөр болон 5-аас 10-р багана хүртэлх утгыг харах 
linelist[2, 5:10] 

# 2-р мөр болон 5-аас 10, 18-р багануудын утгыг харах
linelist[2, c(5:10, 18)] 

# 2-оос 20 хүртэлх мөр, тодорхой багануудыг харах
linelist[2:20, c("date_onset", "outcome", "age")]

# Тодорхой шалгуурт үндэслэн мөр, баганыг харах 
# *** Датафрэймийг шалгуурт нэрлэсэн хэвээр байх ёстойг анхаарна уу! 
linelist[linelist$age > 25 , c("date_onset", "outcome", "age")]

# RStudio Viewer самбар дээрх гаралтыг харахын тулд View()-г ашиглана уу (уншихад хялбар) 
# *** View() функцийн том "V" үсгийг анхаарна уу 
View(linelist[2:20, "date_onset"])

# Шинэ объект болгон хадгалах
new_table <- linelist[2:20, c("date_onset")] 
```

Та мөн **dplyr** синтакс (мөрүүдэд `filter()` функц, багананд `select()` функцийг) ашиглан датафрэйм болон тибл дээр дээрхтэй ижлээр мөр/баганыг индексжүүлэх боломжтойг анхаарна уу. Эдгээр үндсэн функцуудын талаар \[Дата цэвэрлэх ба үндсэн функцууд\] хуудаснаас дэлгэрэнгүй уншина уу.

"Мөрийн дугаар" дээр үндэслэн шүүх бол та **dplyr**-ын`row_number()` функцийг хоосон хаалттайгаар логик шүүлтийн хэсэг болгон ашиглаж болно. Доор үзүүлсэн шиг ихэнх тохиолдолд та `%in%` оператор болон тооны хүрээг логик хэллэгийн нэг хэсэг болгож болдог. *Эхний* N мөрийг харахын тулд та тусгай **dplyr** функц `head()` ашиглах боломжтой.

```{r, eval=F}
# Эхний 100 мөрийг харах
linelist %>% head(100)

# Зөвхөн 5-р мөрийг харуулах
linelist %>% filter(row_number() == 5)

# 2-оос 20 хүртэлх мөр, гурван тодорхой баганыг харах (баганын нэр дээр ишлэл хэрэггүй гэдгийг анхаарна уу) 
linelist %>% filter(row_number() %in% 2:20) %>% select(date_onset, outcome, age)
```

**Лист** ангийн объектыг индекслэх үед зөвхөн ганц объектыг буцаасан ч гэсэн ганц дөрвөлжин хаалт нь лист ангийг буцаана. Харин давхар хаалт нь нэг элементэд хандаж, листээс өөр анги буцаахад ашиглагдаж болно.

Доор үзүүлсэн шиг хаалтуудыг ар араас нь бичиж болно.

[Чинжүү сэгсрэгч ашиглан лист индекслэлтийн талаар тайлбарласан энэхүү дүрсэт тайлбар](https://r4ds.had.co.nz/vectors.html#lists-of-condiments) хошин бөгөөд ойлгоход тустай.

```{r}
# Демо лист тодорхойлох
my_list <- list(
  # Листийн эхний элемент нь тэмдэгтийн вектор
  hospitals = c("Central", "Empire", "Santa Anna"),
  
  # Листийн хоёр дахь элемент нь хаягуудын датафрэйм
  addresses   = data.frame(
    street = c("145 Medical Way", "1048 Brown Ave", "999 El Camino"),
    city   = c("Andover", "Hamilton", "El Paso")
    )
  )
```

Листийг консол дээр хэвлэх үед хэрхэн харагдахыг энд харуулав. Нэрлэгдсэн хоёр элемент байгааг хараарай:

-   `hospitals`, тэмдэгтийн вектор

-   `addresses`, хаягуудын датафрэйм

```{r}
my_list
```

Одоо бид янз бүрийн аргыг ашиглан задалж байна:

```{r}
my_list[1] # энэ нь "лист" анги дахь элементийг буцаана - элементийн нэр харагдсан хэвээр байна 

my_list[[1]] # энэ нь зөвхөн (нэргүй) тэмдэгтийн векторыг буцаана 

my_list[["hospitals"]] # Та мөн листийн элементийн нэрээр индекслэж болно

my_list[[1]][3] # энэ нь "hospitals" тэмдэгтийн векторын гурав дахь элементийг буцаана 

my_list[[2]][1] # Энэ нь хаягийн датафрэймийн эхний баганыг ("street") буцаана

```

<!-- ======================================================= -->

### Объектуудыг устгах {.unnumbered}

Та `rm()` функцэд нэрийг оруулснаар R орчноосоо бие даасан объектуудыг устгаж болно (ишлэлгүй):

```{r, eval=F}
rm(object_name)
```

Та бүх объектыг дараах байдлаар устгаж болно (ажлын талбайгаа цэвэрлэх):

```{r, eval=F}
rm(list = ls(all = TRUE))
```

<!-- ======================================================= -->

<!-- ======================================================= -->

<!-- ======================================================= -->

## Пайплах (`%>%`)

**Объектуудтай ажиллах хоёр ерөнхий арга нь:**

1.  **Pipes/tidyverse** - пайп нь функцээс функц рүү объектыг илгээдэг - объект биш харин үйлдлийг онцолдог.

2.  **Завсрын объектуудыг тодорхойлох** - объект дахин дахин тодорхойлогддог - объект дээр анхаарлаа хандуулдаг

<!-- ======================================================= -->

### **Пайп** {.unnumbered}

**Энгийнээр тайлбарлавал пайп оператор (`%>%`) нь завсрын гаралтыг нэг функцээс нөгөө функц рүү дамжуулдаг.**

Та үүнийг "дараа нь" гэж хэлж байна гэж бодож болно. Олон функцийг `%>%` ашиглан холбож болно.

-   **Пайплах нь үйлдлүүдийг гүйцэтгэж буй объектыг бус харин дараалсан үйлдлүүдийг онцолдог**

-   Нэг объект дээр дараалсан үйлдлүүдийг хийх шаардлагатай үед пайп нь хамгийн тохиромжтой

-   Пайп нь **magrittr** багцаас ашиглагддаг бөгөөд **dplyr** болон **tidyverse** багцад автоматаар ордог

-   Пайп нь кодыг илүү цэвэрхэн, уншихад хялбар, ойлгомжтой болгох боломжтой

Tidyverse [загварын гарын авлагаас](https://style.tidyverse.org/pipes.html) энэ аргын талаар дэлгэрэнгүй уншина уу.

"Бялуу жигнэх" зохиомол функцийг ашиглан харьцуулах хуурамч жишээ энд байна. Эхлээд, пайп арга:

```{r piping_example_pipe, eval=F}
# Пайп синтакс ашиглан бялууг хэрхэн жигнэх тухай хуурамч жишээ 

cake <- flour %>%       # бялууг тодорхойлохдоо гурилаар эхэлж, дараа нь...
  add(eggs) %>%   # өндөг нэмнэ
  add(oil) %>%    # тос нэмнэ
  add(water) %>%  # ус нэмнэ
  mix_together(         # хооронд нь холино
    utensil = spoon,
    minutes = 2) %>%    
  bake(degrees = 350,   # жигнэнэ
       system = "fahrenheit",
       minutes = 35) %>%  
  let_cool()            # хөргөнө
```

Пайп ашиглалтыг тайлбарласан өөр нэг [холбоос](https://cfss.uchicago.edu/notes/pipes/#:~:text=Pipes%20are%20an%20extremely%20useful,code%20and%20combine%20multiple%20operations) энд байна.

Пайп нь **base** функц биш юм. Пайп ашиглахын тулд **magrittr** багцыг суулгаж, ачаалах ёстой (энэ нь ихэвчлэн үүнийг багтаасан **tidyverse** эсвэл **dplyr** багцыг ачаалах замаар хийгддэг). Та [**magrittr** багцын баримт бичигт пайпын талаар илүү ихийг уншиж](https://magrittr.tidyverse.org/) болно.

Бусад R командуудын нэгэн адил пайп нь `<-` оноох оператор оролцож байгаа эсэхээс хамаарч зөвхөн үр дүнг харуулах, объектыг хадгалах/дахин хадгалахад ашиглагдаж болно гэдгийг анхаарна уу. Доор хоёуланг нь харна уу:

```{r, eval=F}
# Насны ангиллаар нийлбэр тоо болгон тодорхойлох объект үүсгэх буюу дарж бичих (хэвлэсэнгүй) 
linelist_summary <- linelist %>% 
  count(age_cat)
```

```{r}
# Тооллогын хүснэгтийг консол дээр хэвлээрэй, гэхдээ үүнийг бүү хадгал
linelist %>% 
  count(age_cat)
```

**`%<>%`**\
Энэ бол **magrittr** багцын "оноолтын пайп" бөгөөд энэ нь *объектыг урагш нь зөөж, мөн объектыг дахин тодорхойлдог*. Энэ нь гинжин хэлхээний анхны пайп оператор байх ёстой. Энэ нь доор буй хоорондоо ижил утгатай хоёр жишээн дээр үзүүлсэн шиг товчлол юм:

```{r, eval=F}
linelist <- linelist %>%
  filter(age > 50)

linelist %<>% filter(age > 50)
```

<!-- ======================================================= -->

### Завсрын объектуудыг тодорхойлох {.unnumbered}

Объект/датафрэйм өөрчлөх энэ арга нь дараах тохиолдолд илүү дээр байж болох юм:

-   Та олон объектыг өөрчлөх хэрэгтэй

-   Завсрын шатууд нь утга учиртай бөгөөд тусдаа объектын нэрийг авах ёстой

**Эрсдэл:**

-   Алхам бүрт шинэ объект бий болгоно гэдэг нь маш олон объект бий болгоно гэсэн үг. Хэрэв та буруу объект ашиглавал түүнийгээ мэдэхгүй байж магадгүй юм!

-   Бүх объектыг нэрлэх нь төөрөгдөл үүсгэдэг

-   Алдаа илрүүлэхэд амаргүй байж магадгүй

Нэг бол завсрын объект бүрийг нэрлэх эсвэл эх хувийг дарж бичих эсвэл бүх функцийг нэгтгэх. Бүгд өөрийн гэсэн эрсдэлтэй байдаг.

Доорх код нь дээрхтэй адил хуурамч "бялуу" жишээ юм, гэхдээ энэ загварыг ашиглаж байна:

```{r piping_example_redefine, eval=F}
# Энэ аргыг ашиглан бялууг хэрхэн жигнэх тухай хуурамч жишээ (завсрын объектыг тодорхойлох) 
batter_1 <- left_join(flour, eggs)
batter_2 <- left_join(batter_1, oil)
batter_3 <- left_join(batter_2, water)

batter_4 <- mix_together(object = batter_3, utensil = spoon, minutes = 2)

cake <- bake(batter_4, degrees = 350, system = "fahrenheit", minutes = 35)

cake <- let_cool(cake)
```

Бүх функцийг нэгтгэх - үүнийг уншихад хэцүү:

```{r eval=F}
# олон функцийг хослуулах/нэгтгэх жишээ - уншихад хэцүү 
cake <- let_cool(bake(mix_together(batter_3, utensil = spoon, minutes = 2), degrees = 350, system = "fahrenheit", minutes = 35))
```

<!-- ======================================================= -->

## Гол операторууд болон функцууд {#operators}

Энэ хэсэгт R хэлний гол операторуудыг дэлгэрэнгүй тайлбарлаж байна, тухайлбал:

-   Тодорхойлогч операторууд

-   Харьцааны операторууд (бага, тэнцүү..)

-   Логик операторууд (ба, эсвэл ...)

-   Хоосон утгатай ажиллах

-   Математикийн операторууд болон функцууд (+/-, >, `sum()`, `median()`, ...)

-   `%in%` оператор

<!-- ======================================================= -->

### Оноолтын операторууд {.unnumbered}

**`<-`**

R хэлний үндсэн оноолтын оператор нь `<-`. `объектын_нэр <- утга` гэж ашиглагддаг. Энэхүү оноолтын операторыг мөн `=` ашиглан бичиж болно. Бид ерөнхий R хэрэглээнд `<-`-г ашиглахыг зөвлөж байна. Мөн уншихад хялбар байх үүднээс ийм операторуудыг зайгаар хүрээлэхийг зөвлөж байна.

**`<<-`**

Хэрэв \[Функц бичих\] эсвэл R-г үүсвэртэй скриптүүдтэй интерактив байдлаар ашиглаж байгаа бол та оноолтын оператор `<<-` (**base** R-аас) ашиглах шаардлагатай болж магадгүй юм. Энэ операторыг дээд түвшний "толгой" R орчин дахь объектыг тодорхойлоход ашигладаг. Үүний талаар энэхүү [онлайн лавлагааг](https://stat.ethz.ch/R-manual/R-devel/library/base/html/assignOps.html) үзнэ үү.

**`%<>%`**

Энэ бол **magrittr** багцын "оноолтын пайп" бөгөөд энэ нь *объектыг урагш нь зөөж, мөн объектыг дахин тодорхойлдог*. Энэ нь гинжин хэлхээний анхны пайп оператор байх ёстой бөгөөд товчлолын нэг хэлбэр юм. Доорх хоёр команд нь яг ижил үйлдэл хийж байна:

Энэ бол **magrittr** багцын "оноолтын пайп" бөгөөд энэ нь объектыг урагш зөөж, мөн объектыг дахин тодорхойлдог. Энэ нь гинжин хэлхээний анхны хоолойн оператор байх ёстой. Энэ нь доор буй хоорондоо ижил утгатай хоёр жишээн дээр үзүүлсэн шиг товчлол юм:

```{r, eval=F}
linelist <- linelist %>% 
  mutate(age_months = age_years * 12)
```

Дээрх код нь доорх кодтой яг ижил үйлдэл хийж байна.

```{r, eval=F}
linelist %<>% mutate(age_months = age_years * 12)
```

**`%<+%`**

Энэ нь **ggtree** багц ашиглан филогенетик модонд дата нэмэхэд хэрэглэгддэг. \[Филогенетик мод\] дээрх хуудас эсвэл энэ [онлайн номыг](https://yulab-smu.top/treedata-book/) үзнэ үү.

<!-- ======================================================= -->

### Харьцааны болон логик операторууд {.unnumbered}

Харьцааны операторууд утгыг хооронд нь харьцуулах, шинэ хувьсагч болон датасетийн доторх хэсгийг тодорхойлоход ихэвчлэн ашиглагддаг. R хэл дээрх нийтлэг харьцааны операторууд энд байна:

| Илэрхийлэл            | Оператор   | Жишээ        | Жишээний үр дүн                                                                                                                                                     |
|-----------------------|------------|--------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Тэнцүү                | `==`       | `"A" == "a"` | `FALSE` (Учир нь R нь үсгийн том, жижигт мэдрэг) == (*давхар тэнцүү*) нь *`<-`* оноолтын оператор шиг ажилладаг = (*ганц тэнцүү*)-ээс ялгаатай гэдгийг анхаарна уу. |
| Тэнцүү биш            | `!=`       | `2 != 0`     | `TRUE`                                                                                                                                                              |
| -аас их               | `>`        | `4 > 2`      | `TRUE`                                                                                                                                                              |
| -аас бага             | `<`        | `4 < 2`      | `FALSE`                                                                                                                                                             |
| -аас их буюу тэнцүү   | `>=`       | `6 >= 4`     | `TRUE`                                                                                                                                                              |
| -аас бага буюу тэнцүү | `<=`       | `6 <= 4`     | `FALSE`                                                                                                                                                             |
| Утга байхгүй          | `is.na()`  | `is.na(7)`   | `FALSE` (\[Хоосон дата\] хуудсыг үзнэ үү)                                                                                                                           |
| Утга байгаа           | `!is.na()` | `!is.na(7)`  | `TRUE`                                                                                                                                                              |

AND ба OR гэх мэт логик операторуудыг ихэвчлэн харьцааны операторуудыг холбож, илүү комплекс шалгууруудыг бий болгоход ашигладаг. Нарийн комплекс мэдэгдлүүд бүлэглэх болон үйлдлийн дарааллыг хадгалахын тулд бөөрөнхий хаалт ( ) ашиглах шаардлагатай байж болно.

Logical operators, such as AND and OR, are often used to connect relational operators and create more complicated criteria. Complex statements might require parentheses ( ) for grouping and order of application.

| Утга            | Оператор                                                                    |
|-----------------|-----------------------------------------------------------------------------|
| AND             | `&`                                                                         |
| OR              | `|` (босоо шугам)                                                           |
| Бөөрөнхий хаалт | `( )` Шалгууруудыг нэгтгэж, үйл ажиллагааны дарааллыг тодруулахад ашигладаг |

Жишээ нь, доор бидэнд тохиолдлын тодорхойлолтыг бий болгохдоо ашиглахыг хүсэж буй хоёр хувьсагч бүхий лайнлист байна: тестийн үр дүн `hep_e_rdt` болон тухайн өрхөд өөр тохиолдол байгаа эсэхийг илтгэх `other_cases_in_hh`. Дараах команд нь `case_when()` функцийг ашиглан `case_def` гэсэн шинэ хувьсагчийг үүсгэнэ.

```{r eval=FALSE}
linelist_cleaned <- linelist %>%
  mutate(case_def = case_when(
    is.na(rdt_result) & is.na(other_case_in_home)            ~ NA_character_,
    rdt_result == "Positive"                                 ~ "Confirmed",
    rdt_result != "Positive" & other_cases_in_home == "Yes"  ~ "Probable",
    TRUE                                                     ~ "Suspected"
  ))
```

| Дээрх жишээн дээрх шалгуурууд                                                                | "case_def" шинэ хувьсагчийн үр дүнгийн утга |
|----------------------------------------------------------------------------------------------|---------------------------------------------|
| Хэрэв `rdt_result` болон `other_cases_in_home` хувьсагчийн утга байхгүй бол                  | `NA` (хоосон)                               |
| Хэрэв `rdt_result` дахь утга "Positive" бол                                                  | "Confirmed"                                 |
| Хэрэв `rdt_result` дахь утга "Positive" БИШ БӨГӨӨД `other_cases_in_home` дахь утга "Yes" бол | "Probable"                                  |
| Дээрх шалгууруудын аль нэгийг хангаагүй бол                                                  | "Suspected"                                 |

*R хэл нь үсэгний том, жижигт мэдрэг тул "Positive" нь "positive"-ээс өөр гэдгийг анхаарна уу...*

<!-- ======================================================= -->

### Хоосон утгууд {.unnumbered}

R-д хоосон утгыг `NA` ("нөөцлөгдсөн" утга) гэсэн тусгай утгаар илэрхийлнэ (N ба A том үсэг- ишлэл дотор биш). Хэрэв та хоосон датаг өөр аргаар (жишээ нь 99, "Missing" эсвэл .) бүртгэсэн дата импортлох юм бол эдгээр утгыг `NA` руу дахин кодлохыг хүсэж болох юм. Үүнийг хэрхэн хийх талаар \[Импорт, экспорт\] хуудаснаас үзнэ үү.

**Утга нь `NA` эсэхийг шалгахын тулд `TRUE` эсвэл `FALSE` буцаадаг `is.na()` тусгай функцийг ашиглана.**

```{r basics_operators_missing}
rdt_result <- c("Positive", "Suspected", "Positive", NA)   # хоёр эерэг тохиолдол, нэг сэжигтэй, нэг нь тодорхойгүй байна 
is.na(rdt_result)  # rdt_result-ийн утга NA эсэхийг шалгана
```

Хоосон, хязгааргүй (infinite), `NULL` болон боломжгүй утгуудын талаар дэлгэрэнгүйг \[Хоосон дата\] хэсгээс уншина уу. \[Импорт, экспорт\] хуудсан дээр дата импортлохдоо хоосон утгыг хэрхэн хөрвүүлэх талаар олж мэдээрэй.

<!-- ======================================================= -->

### Математик, статистик {.unnumbered}

Энэ хуудасны бүх операторууд болон функцууд нь **base** R-д ашиглахад бэлэн бий.

#### Математик операторууд {.unnumbered}

Эдгээрийг ихэвчлэн нэмэх, хуваах, шинэ багана үүсгэх гэх мэт үйлдлүүдэд ашигладаг. Доорх нь R хэл дээрх нийтлэг математик операторууд юм. Операторуудын эргэн тойронд хоосон зай тавих эсэх нь чухал биш.

| Зорилго              | R дээрх жишээ |
|----------------------|---------------|
| нэмэх                | 2 + 3         |
| хасах                | 2 - 3         |
| үржүүлэх             | 2 \* 3        |
| хуваах               | 30 / 5        |
| зэрэг дэвшүүлэх      | 2\^3          |
| үйлдлүүдийн дараалал | ( )           |

#### Математик функцууд {.unnumbered}

| Зорилго              | Функц                                 |
|----------------------|---------------------------------------|
| бүхэлдэх             | round(x, digits = n)                  |
| бүхэлдэх             | janitor::round_half_up(x, digits = n) |
| тааз (round up)      | ceiling(x)                            |
| шал (round down)     | floor(x)                              |
| үнэмлэхүй утга       | abs(x)                                |
| квадрат язгуур       | sqrt(x)                               |
| илтгэгч              | exponent(x)                           |
| натурал логарифм     | log(x)                                |
| 10 суурьтай логарифм | log10(x)                              |
| 2 суурьтай логарифм  | log2(x)                               |

Тэмдэглэл: `round()` функцын `digits =` аргумент нь аравтын бутархайн тоог заана. `signif()` функцыг ашиглан хэд хэдэн чухал тоо болгон бүхэлдэнэ үү.

#### Шинжлэх ухааны тэмдэглэгээ {.unnumbered}

Шинжлэх ухааны тэмдэглэгээг ашиглах магадлал нь `scipen` тохируулгын утгаас хамаарна.

`?options` хуудаснаас: `scipen` нь тоон утгыг тогтмол эсвэл экспоненциал тэмдэглэгээгээр хэвлэх шийдвэр гаргахад хэрэглэх шийтгэл юм. Эерэг утгууд нь тогтмол, сөрөг утгууд нь шинжлэх ухааны тэмдэглэгээ рүү хазайдаг: "scipen" цифрээс илүү өргөн биш л бол тогтмол тэмдэглэгээг илүүд үзнэ.

Хэрэв үүн дээр бага тоо (жишээ нь 0) тавьсан бол үргэлж "асаалттай" байх болно. R сессийн шинжлэх ухааны тэмдэглэгээг "унтраахын" тулд үүнийг маш өндөр тоонд тохируулна уу, жишээлбэл:

```{r, eval=F}
# шинжлэх ухааны тэмдэглэгээг унтраа
options(scipen=999)
```

#### Бүхэлдэх {.unnumbered}

[***АЮУЛ:*** `round()` функц нь зөвхөн дээд тоо нь тэгш байвал .5-аас дээшээ бүхэлддэг "банкны бүхэлдэх" аргыг ашигладаг. Хагасыг хамгийн ойрын бүхэл тоо хүртэл тогтмол бүхэлдэхийн тулд **janitor** багцын `round_half_up()`-г ашиглана уу. [Энэ тайлбарыг](https://cran.r-project.org/web/packages/janitor/vignettes/janitor.html#explore-records-with-duplicated-values-for-specific-combinations-of-variables-with-get_dupes) үзнэ үү.]{style="color: red;"}

```{r}
# өөрийн ажилд тохирох бүхэлдэх функцийг ашиглана уу 
round(c(2.5, 3.5))

janitor::round_half_up(c(2.5, 3.5))
```

#### Статистикийн функцууд {.unnumbered}

[***АНХААРУУЛГА:*** Доорх функцууд нь тооцоололдоо хоосон утгуудыг өгөгдмөлөөр оруулдаг. `na.rm = TRUE` аргументыг заагаагүй бол хоосон утгууд нь `NA` үүсгэнэ. Үүнийг товчоор `na.rm = T` гэж бичиж болно.]{style="color: orange;"}

| Зорилго             | Функц              |
|---------------------|--------------------|
| дундаж (average)    | mean(x, na.rm=T)   |
| голч                | median(x, na.rm=T) |
| стандарт хазайлт    | sd(x, na.rm=T)     |
| квантилүүд\*        | quantile(x, probs) |
| нийлбэр             | sum(x, na.rm=T)    |
| хамгийн бага утга   | min(x, na.rm=T)    |
| хамгийн их утга     | max(x, na.rm=T)    |
| тоон утгуудын хүрээ | range(x, na.rm=T)  |
| хураангуй\*\*       | summary(x)         |

Тэмдэглэл:

-   `*quantile()`: `x` нь шалгах тоон вектор, `probs =` нь 0-ээс 1.0 хоорондахь магадлал бүхий тоон вектор, жишээлбэл `c(0.5, 0.8, 0.85)`
-   `**summary()`: дундаж, голч, нийтлэг персентилүүд зэрэг тоон векторын хураангуйг өгдөг

[***АЮУЛ:*** Хэрэв дээрх функцүүдийн аль нэгэнд тоон вектор өгвөл `c()` дотор тоонуудыг нийлүүлж оруулахаа мартуузай.]{style="color: red;"}

```{r}
# Хэрэв функцэд тоонууд өгч байгаа бол тэдгээрийг c()-д боож өгнө үү. 
mean(1, 6, 12, 10, 5, 0)    # !!! БУРУУ !!!  

mean(c(1, 6, 12, 10, 5, 0)) # ЗӨВ
```

#### Бусад хэрэгтэй функцууд {.unnumbered}

| Зорилго                 | Функц             | Жишээ                                           |
|-------------------------|-------------------|-------------------------------------------------|
| дараалал үүсгэх         | seq(from, to, by) | `seq(1, 10, 2)`                                 |
| x-ийг n удаа давтах     | rep(x, ntimes)    | `rep(1:3, 2)` or `rep(c("a", "b", "c"), 3)`     |
| тоон векторыг хуваах    | cut(x, n)         | `cut(linelist$age, 5)`                          |
| санамсаргүй түүвэр авах | sample(x, size)   | `sample(linelist$id, size = 5, replace = TRUE)` |

<!-- ======================================================= -->

### `%in%` {.unnumbered}

Утгыг тааруулах, утгыг вектор эсвэл датафрэйм дотор байгаа эсэхийг хурдан үнэлэхэд маш хэрэгтэй оператор.

```{r}
my_vector <- c("a", "b", "c", "d")
```

```{r}
"a" %in% my_vector
"h" %in% my_vector
```

Утга нь вектор `%in%` (%дотор%) байхгүй эсэхийг шалгахын тулд логик хэллэгийн **өмнө** анхаарлын тэмдэг (!) тавина:

```{r}
# үгүйсгэхэд өмнө нь анхаарлын тэмдэг тавина
!"a" %in% my_vector
!"h" %in% my_vector
```

**dplyr** багцын `case_when()` функцийг ашиглахад `%in%` маш хэрэгтэй. Та векторыг өмнө нь тодорхойлж, дараа нь лавлаж болно. Жишээлбэл:

```{r eval=F}
affirmative <- c("1", "Yes", "YES", "yes", "y", "Y", "oui", "Oui", "Si")

linelist <- linelist %>% 
  mutate(child_hospitaled = case_when(
    hospitalized %in% affirmative & age < 18 ~ "Hospitalized Child",
    TRUE                                      ~ "Not"))
```

Тэмдэглэл: Хэрэв та **stringr** багцын `str_detect()` ашиглан стрингийн хэсгийг илрүүлэхийг хүсвэл энэ нь `c("1", "Yes", "yes", "y")` гэх мэт тэмдэгтийн векторыг хүлээн авдаггүй. Үүний оронд "1\|Yes\|yes\|y" гэх мэт OR босоо шугам бүхий нэг хураангуй стринг бүхий *ердийн* *илэрхийлэл (regular expression)* өгөх ёстой. Жишээлбэл, `str_detect(hospitalized, "1|Yes|yes|y")`. Дэлгэрэнгүй мэдээллийг \[Тэмдэгт болон стринг\] хуудаснаас үзнэ үү.

Та энэ командыг ашиглан тэмдэгтийн векторыг нэрлэсэн ердийн илэрхийлэл болгон хувиргаж болно:

```{r}
affirmative <- c("1", "Yes", "YES", "yes", "y", "Y", "oui", "Oui", "Si")
affirmative

# багасгах 
affirmative_str_search <- paste0(affirmative, collapse = "|")  # base R
affirmative_str_search <- str_c(affirmative, collapse = "|")   # stringr багц

affirmative_str_search
```

<!-- ======================================================= -->

<!-- ======================================================= -->

<!-- ======================================================= -->

## Алдаа болон анхааруулга

Энэ хэсэгт дараахь зүйлийг тайлбарласан:

-   Алдаа болон анхааруулгын ялгаа

-   R код бичих ерөнхий синтакс зөвлөмжүүд

-   Кодын туслахууд

Нийтлэг алдаа, анхааруулга, алдааг олж засварлах зөвлөмжийг \[Алдаа болон тусламж\] хуудаснаас олж болно.

<!-- ======================================================= -->

### Алдаа versus анхааруулга {.unnumbered}

Заримдаа команд ажиллуулах үед R консол танд анхааруулга эсвэл алдааны мэдэгдлийг улаан бичвэрээр харуулах болно.

-   **Анхааруулга** нь R таны командыг гүйцэтгэсэн боловч нэмэлт алхмуудыг хийх хэрэгтэй болсон эсвэл таны мэдэж байх ёстой хэвийн бус гаралт гаргасан гэсэн үг юм.

-   **Алдаа** нь R таны командыг гүйцээж чадаагүй гэсэн үг.

Сэжүүр хайх:

-   Алдаа/анхааруулах мессеж нь ихэвчлэн асуудлын мөрийн дугаарыг агуулна.

-   Хэрэв объект "үл мэдэгдэх" эсвэл "олдохгүй" бол та буруу бичсэн, library() функцээр багц ачааллахаа мартсан эсвэл өөрчлөлт хийсний дараа скриптийг дахин ажиллуулахаа мартсан байж магадгүй юм.

Хэрэв эдгээрийн аль нь ч биш байвал алдааны мессежийг зарим үндсэн нэр томъёоны хамт Google рүү хуулна уу - өөр хэн нэгэн үүнийг аль хэдийн даван туулсан байх магадлал өндөр!

<!-- ======================================================= -->

### Синтаксийн ерөнхий зөвлөмжүүд {.unnumbered}

R дээр команд бичихдээ алдаа, анхааруулгаас зайлсхийхийн тулд хэд хэдэн зүйлийг санах хэрэгтэй:

-   Үргэлж хаалт хаах - зөвлөгөө: кодын хэсэг бүрийн нээх "(" ба хаах хаалтуудын ")" тоог тоол.

-   Багана болон объектын нэрэнд хоосон зай оруулахаас зайлсхий. Оронд нь доогуур зураас ( \_ ) эсвэл цэг ( . ) ашиглана уу

-   Функцийн аргументуудыг таслалаар салгахаа бүү мартаарай

-   R нь үсгийн том, жижигт мэдрэг бөгөөд `Variable_A` нь `variable_A`-аас ялгаатай гэсэн үг

<!-- ======================================================= -->

### Кодын туслахууд {.unnumbered}

Аливаа скрипт (RMarkdown эсвэл бусад) нь таныг алдаа гаргасан үед сэжүүр өгөх болно. Жишээлбэл, хэрэв та шаардлагатай газар таслал бичих, эсвэл хаалт хаахаа мартсан бол RStudio танд анхааруулахын тулд тухайн мөрөнд, скриптийн баруун талд туг өргөх болно.
