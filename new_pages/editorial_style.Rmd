# Редакцийн болон техникийн тэмдэглэл

Энэ хуудсанд энэхүү гарын авлагыг бүтээх явцад бидний барьсан философийн арга барил, хэв маяг, редакцийн тодорхой шийдвэрүүдийг тайлбарласан болно.

## Арга барил, загвар

Энэхүү номын уншигчдын хүрээ маш өргөн байх боломжтой. R-ийг анхлан сурч буй хүмүүс хэрэглэх нь гарцаагүй бөгөөд мөн туршлагатай R хэрэглэгчид ч шилдэг туршлага, зөвлөгөөг хайн унших болно. Тиймээс энэхүү ном ойлгомжтой бөгөөд товч тодорхой байх ёстой. Тийм болохоор бид R анхлан сурж буй хүн кодыг ашиглаж, тухайн код юу хийж буйг ойлгох хэмжээний *дөнгөж хангалттай* бичгэн тайлбар хийхийг зорьсон.

Өөр хэдэн зүйл:

-   Энэ бол харьцангуй богино жишээтэй кодын лавлагаа ном юм - R эсвэл өгөгдлийн шинжлэх ухааны талаарх гүнзгий сурах бичиг *биш*
-   Энэ бол хэрэглээний тархвар судлалд хэрэглэгдэх *R гарын авлага* - хэрэглээний тархвар судлалын шинжлэх ухаан эсвэл аргачлалын гарын авлага биш
-   Энэхүү ном амьд ном байхыг зорьж буй - тодорхой үйлдэл хийхэд хамгийн тохиромжтой R багцууд өөрчлөгдөх нь түгээмэл бөгөөд бид энэхүү гарын авлагад алийг нь тусгах талаар хэлэлцүүлгийг таатай хүлээн авах болно

### R багцууд {.unnumbered}

**Маш олон сонголтууд**

R сурахад хамгийн төвөгтэй талуудын нэг нь тухайн даалгаварт яг аль R багцыг ашиглахаа мэдэх явдал юм. Нэг даалгавар гүйцэтгэхийн тулд маш их код бичсэний дараа тухайн даалгаврыг ганцхан мөр кодоор хийчихдэг R багц байдгийг мэдэх нь түгээмэл.

Бид энэхүү гарын авлагад даалгавар бүрийг гүйцэтгэх хоёроос доошгүй аргыг санал болгохыг хичээсэн: нэг нь туршиж үзсэн, найдвартай арга (магадгүй **суурь** R эсвэл **tidyverse**), нөгөө нь тухайн даалгаварт тусгайлан зориулж бүтээсэн R багц. Өгөгдсөн багцыг татаж авах боломжгүй эсвэл өөр шалтгаанаар ажиллахгүй байж болох учир бид уншигчдыг хэд хэдэн сонголттой байлгахыг хүссэн.

Аль багцыг ашиглахаа сонгохдоо бид олон нийтийн зүгээс туршиж, шалгаж үзсэн, энгийн ажлын үед хэрэглэгддэг багцуудын тоог багасгадаг, тогтвортой (ойр ойрхон өөрчлөгддөггүй), тухайн даалгаврыг энгийн бөгөөд тодорхой гүйцэтгэдэг R багцууд болон арга барилуудыг урьдал болгосон.

Энэхүү гарын авлага ерөнхийдөө **tidyverse**-ийн R багцууд, функцуудыг голчлон хэрэглэсэн болно. Tidyverse бол үндсэн дүрэм, өгөгдлийн бүтцийн хувьд ижил, өгөгдлийн шинжлэх ухаанд зориулагдсан R багцуудын цуглуулга юм. Бүх tidyverse-ийн багцуудыг **tidyverse** багц ашиглан суулгаж эсвэл ачаалж болно. Дэлгэрэнгүйг [tidyverse вэбсайт](https://www.tidyverse.org/) дээрээс уншина уу.

Бид мөн шаардлагатай тохиолдолд ашиглаж болох **суурь** R ашигласан кодын сонголтыг оруулсан. Суурь R (base R) гэдэг нь R суулгах явцад түүнтэй хамт ирдэг багцууд, функцуудыг хэлж буй. Үүний учир нь энэ номын зарим уншигчид нэмэлт багц татаж авах найдвартай интернетгүй байж магадгүй юм.

**Функцийг багцтай ил тод холбох нь**

R-ийн зарим хичээлүүдийн кодонд нэг функцыг ашиглаж буй боловч тухайн функц ямар багцаас ашиглагдаж буйг харуулдаггүй нь нэлээд төвөгтэй байдаг. Бид ийм нөхцөл байдлаас зайлсхийхийг хичээсэн.

Номын өгүүлэл текстэнд багцын нэрүүд тодоор (ж.нь **dplyr**) бичигдсэн бөгөөд функцууд дараах байдлаар бичигдсэн: `mutate()`. Ойролцоох текст дэх багцыг дурдах эсвэл кодонд багцыг ийм байдлаар (`dplyr::mutate()`) тодорхой зааж өгөх замаар тухайн функц нь ямар багцаас гаралтай болохыг тодорхой харуулахыг бид хичээсэн. Энэ нь илүү ажил мэт санагдаж болох ч бид үүнийг албаар ингэж харуулж байгаа болно.

[R-ын суурь] хэсгээс багцууд, функцуудын талаар дэлгэрэнгүй мэдээлэл авч болно.

### Кодын загвар {.unnumbered}

Бид гарын авлагадаа "шинэ мөрнүүд"-ийг тогтмол ашигласнаар бидний код "урт" мэт харагдана. Бид үүнийг хэд хэдэн шалтгааны улмаас хийж байна:

-   Бид кодын жижиг хэсэг бүрийн хажууд `#` тэмдэг ашиглан тайлбар бичиж болно\
-   Ерөнхийдөө урт (босоо) кодыг уншихад илүү амар байдаг\
-   Нарийхан дэлгэц дээр уншихад илүү амар (хажуу тийш нь гүйлгэх шаардлагагүй)\
-   Догол мөрөөс харахад ямар аргументууд аль функцэд хамааралтай болохыг мэдэхэд илүү хялбар болно

Үүний үр дүнд дараах байдлаар бичигдэж болох код:

```{r, eval=F}
linelist %>% 
  group_by(hospital) %>%  # мөрүүдийг эмнэлгээр бүлэглэх
  slice_max(date, n = 1, with_ties = F) # хэрвээ (огнооны) давхцал байвал эхний мөрийг нь сонгох
```

...ингэж бичигдэнэ:

```{r, eval=F}
linelist %>% 
  group_by(hospital) %>% # мөрүүдийг эмнэлгээр бүлэглэх
  slice_max(
    date,                # бүлэг тус бүрийн хамгийн сүүлийн (өндөр) огноо бүхий мөрийг үлдээх
    n = 1,               # хамгийн өндөр ганцхан мөрийг үлдээх 
    with_ties = F)       # хэрвээ (огнооны) давхцал байвал эхний мөрийг нь сонгох
```

Шинэ мөр эсвэл догол мөрнүүд ерөнхийдөө R кодод нөлөөлдөггүй. Код бичихдээ таслалын дараа шинэ мөр эхлүүлбэл догол мөрийг автоматаар ашиглах болно.

Бид мөн уншихад илүү хялбар байдаг тул хоосон зайг ихээр ашигладаг (жишээлбэл `n=1` биш `n = 1`). Таны кодыг уншиж буй хүмүүсээ бодоорой!

### Нэр томъёо {.unnumbered}

Энэхүү гарын авлагад бид "хувьсагч (variables)", "ажиглалт (observations)" гэхийн оронд ерөнхийдөө "багана (columns)" ба "мөр (rows)"-ийг ашигласан. Энэхүү ["цэгцтэй өгөгдөл"](https://tidyr.tidyverse.org/articles/tidy-data.html) гэсэн материалд тайлбарласнаар ихэнх эпидемиологийн статистикийн өгөгдлийн багц нь бүтцийн хувьд мөр, багана, утгуудаас бүрддэг.

Хувьсагч нь ижил үндсэн шинж чанарыг хэмжсэн утгыг агуулдаг (насны бүлэг, үр дүн, эхлэх огноо гэх мэт). Ажиглалт нь нэг нэгжээр хэмжигдэх бүх утгыг агуулдаг (жишээлбэл, хүн, байршил эсвэл лабораторийн сорьц). Тиймээс иймэрхүү шинж чанарыг бодитоор тодорхойлоход төвөгтэй байж магадгүй юм.

"Цэгцтэй" өгөгдлийн багцад багана бүр хувьсагч, мөр бүр ажиглалт, нүд бүр нэг утгатай байна. Хэдий тийм боловч таны ашиглаж буй зарим өгөгдлийн багц энэ загварт тохирохгүй байх нь элбэг - жишээ нь "өргөн" форматтай өгөгдлийн багц нь хэд хэдэн баганад хуваагдсан хувьсагчтай байж болно ([Pivoting data] хуудсан дээрх жишээг үзнэ үү). Үүний нэгэн адил ажиглалт мөн хэд хэдэн мөрөнд хуваагдсан байж болдог.

Энэхүү гарын авлагын ихэнх нь өгөгдлийг удирдах, өөрчлөх тухай байгаа тул хийсвэр ойлголтууд болох ажиглалт, хувьсагчаас илүүтэй тодорхой ойлголтууд болох мөр, баганаар өгөгдлийн бүтцийг дурдах нь илүү ойлгомжтой юм. Үүнд хамаарахгүй зүйлүүд нь голчлон өгөгдлийн дүн шинжилгээний талаарх хуудсуудад гарч ирэх бөгөөд дүн шинжилгээний хувьд та хувьсагч, ажиглалт гэсэн ойлголтуудтай түлхүү тулгарах болно.

### Тэмдэглэл {.unnumbered}

Энэхүү гарын авлагад дурдагдах тэмдэглэлийн төрлүүд энд байна:

[***ТЭМДЭГЛЭЛ:*** Энэ бол тэмдэглэл.]{style="color: black;"}\
[***ЗӨВЛӨГӨӨ:*** Энэ бол зөвлөгөө.]{style="color: darkgreen;"}\
[***СЭРЭМЖЛҮҮЛЭГ:*** Энэ бол сэрэмжлүүлэх тэмдэглэл.]{style="color: orange;"}\
[***АЮУЛ:*** Энэ бол анхааруулга.]{style="color: red;"}

## Редакцийн шийдвэр

Доорх хүснэгтээр бид багц болон функцын сонголтын талаархи редакцийн чухал шийдвэрүүдийг хянан дагаж байна. Хэрэв та санал нийлэхгүй байгаа эсвэл шинэ багц/функц санал болгохыг хүсвэл манай [Github хуудсан](https://github.com/epirhandbook/Epi_R_handbook) дээр нэгдэж харилцан яриа эхлүүлнэ үү.

**Багц, функц болон бусад редакцийн шийдвэрийн хүснэгт**

+-------------------------------+---------------------------------------------------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------+
| Сэдэв                         | Авч үзсэн                                                                       | Үр дүн                                                                                                                                                   | Товч үндэслэл                                                                                        |
+===============================+=================================================================================+==========================================================================================================================================================+======================================================================================================+
| Ерөнхий кодлох арга барил     | **tidyverse**, **data.table**, **base**                                         | **tidyverse**, with a page on **data.table**-ийн талаар нэг хуудас бүхий, мөн интернетгүй уншигчдад зориулан **base** хувилбаруудын талаар дурдсан болно | **tidyverse** уншигдах байдал, түгээмэл байдал, хамгийн их заагддаг                                  |
+-------------------------------+---------------------------------------------------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------+
| Багц ачаалах                  | `library()`,`install.packages()`, `require()`, **pacman**                       | **pacman**                                                                                                                                               | Ихэнх олон багц суулгах/ачаалах тохиолдлын кодыг богиносгож, хялбаршуулдаг                           |
+-------------------------------+---------------------------------------------------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------+
| Импорт, экспорт               | **rio**, бусад олон багцууд                                                     | **rio**                                                                                                                                                  | Олон төрлийн файлын хувьд хялбар                                                                     |
+-------------------------------+---------------------------------------------------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------+
| Дүгнэлт статистикийг бүлэглэх | **dplyr** `group_by()`, **stats** `aggregate()`                                 | **dplyr** `group_by()`                                                                                                                                   | **tidyverse**-тэй нийцдэг                                                                            |
+-------------------------------+---------------------------------------------------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------+
| Пивот хийх                    | **tidyr** (пивот функцууд), **reshape2** (melt/cast), **tidyr** (spread/gather) | **tidyr** (пивот функцууд)                                                                                                                               | **reshape2**-ийн хөгжүүлэлт зогссон, **tidyr**-ийн v1.0.0-ээс эхлээд тусгай пивот функцуудтай болсон |
+-------------------------------+---------------------------------------------------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------+
| Баганын нэрүүдийг цэвэрлэх    | **linelist**, **janitor**                                                       | **janitor**                                                                                                                                              | Багцуудын нэгтгэлийг онцлов                                                                          |
+-------------------------------+---------------------------------------------------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------+
| Epiweeks                      | **lubridate**, **aweek**, **tsibble**, **zoo**                                  | Голчлон **lubridate**, бусдыг нь онцгой тохиолдлуудад                                                                                                    | **lubridate**-ийн уян хатан байдал, тогтвортой байдал, багцын цаашдын хөгжүүлэлтийн төлөв            |
+-------------------------------+---------------------------------------------------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------+
| ggplot шошгууд                | `labs()`, `ggtitle()`/`ylab()`/`xlab()`                                         | `labs()`                                                                                                                                                 | бүх шошго нэг дор, энгийн байдал                                                                     |
+-------------------------------+---------------------------------------------------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------+
| Фактор болгон хөрвүүлэх       | `factor()`, **forcats**                                                         | **forcats**                                                                                                                                              | энэхүү багцын төрөл бүрийн функцууд нь тухайн командын дотор мөн фактор болгон хувиргадаг            |
+-------------------------------+---------------------------------------------------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------+
| Эпидемийн муруй               | **incidence**, **ggplot2**, **EpiCurve**                                        | **incidence2** хурднаар, **ggplot2** нарийвчлалтайгаар                                                                                                   | найдвартай байдал                                                                                    |
+-------------------------------+---------------------------------------------------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------+
| Холболт (Concatenation)       | `paste()`, `paste0()`, `str_glue()`, `glue()`                                   | `str_glue()`                                                                                                                                             | `paste()` функцээс илүү энгийн синтакстай; **stringr** багцад багтдаг                                |
+-------------------------------+---------------------------------------------------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------+

## Гол өөрчлөлт

| Огноо               | Томоохон өөрчлөлтүүд      |
|---------------------|---------------------------|
| 2021 оны 5 сарын 10 | 1.0.0 хувилбарыг гаргасан |

## Session мэдээлэл (R, RStudio, багцууд)

Энэхүү гарын авлагыг гаргах явцад ашигласан R, RStudio, R багцын хувилбаруудын талаархи мэдээллийг доор өгөв.

```{r}
sessioninfo::session_info()
```
